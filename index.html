<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartSave - AI-Powered Savings Coach</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #0f172a; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .gradient-text { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .streak-flame { animation: flicker 1.5s infinite alternate; }
        @keyframes flicker { 0% { opacity: 1; transform: scale(1); } 100% { opacity: 0.8; transform: scale(1.1); } }
        .slide-in { animation: slideIn 0.5s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .pulse-glow { animation: pulseGlow 2s infinite; }
        @keyframes pulseGlow { 0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.5); } 50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.8); } }
        .confetti { position: fixed; width: 10px; height: 10px; background: #f0f; animation: confetti-fall 3s linear forwards; z-index: 9999; }
        @keyframes confetti-fall { to { transform: translateY(100vh) rotate(360deg); opacity: 0; } }
        .bank-card { transition: all 0.3s ease; cursor: pointer; }
        .bank-card:hover { transform: scale(1.05); border-color: rgba(99, 102, 241, 0.5); }
        .sync-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .fade-out { animation: fadeOut 0.5s ease-out forwards; }
        @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }
        .demo-bg { filter: blur(2px) brightness(0.4); pointer-events: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow-y: auto; z-index: 0; }
        .empty-state { text-align: center; padding: 3rem 1rem; color: #6b7280; }
        .empty-state i { font-size: 3rem; margin-bottom: 1rem; opacity: 0.5; }
        input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }
        
        /* Profile dropdown fix */
        .profile-menu-container { position: relative; }
        .profile-dropdown {
            position: absolute;
            right: 0;
            top: calc(100% + 0.5rem);
            width: 12rem;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
            z-index: 50;
        }
        .profile-menu-container:hover .profile-dropdown,
        .profile-dropdown:hover {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .profile-menu-container::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            height: 0.5rem;
            background: transparent;
        }
        
        /* Alert animations */
        .alert-breach { animation: alertPulse 1s infinite; border-color: rgba(239, 68, 68, 0.8) !important; }
        @keyframes alertPulse { 0%, 100% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.5); } 50% { box-shadow: 0 0 40px rgba(239, 68, 68, 0.8); } }
        
        .transaction-item { position: relative; }
        .delete-btn {
            opacity: 0;
            transition: all 0.2s ease;
        }
        .transaction-item:hover .delete-btn {
            opacity: 1;
        }
        
        .ai-thinking { animation: aiPulse 2s infinite; }
        @keyframes aiPulse { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
        
        .pattern-card {
            border-left: 3px solid #8b5cf6;
            background: linear-gradient(90deg, rgba(139, 92, 246, 0.1) 0%, transparent 100%);
        }
        
        .prediction-up { color: #10b981; }
        .prediction-down { color: #ef4444; }
    </style>
</head>
<body class="text-white min-h-screen overflow-x-hidden">

    <!-- Confetti Container -->
    <div id="confetti-container"></div>

    <!-- DEMO BACKGROUND -->
    <div id="demo-background" class="demo-bg">
        <div class="pt-24 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto opacity-50">
            <div class="mb-8">
                <h1 class="text-4xl md:text-5xl font-bold mb-2">Welcome back, <span class="gradient-text">Demo User</span>! üéØ</h1>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/90 backdrop-blur-sm">
        <div class="w-full max-w-4xl grid md:grid-cols-2 gap-8 items-center relative z-10">
            <div class="text-center md:text-left">
                <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center mx-auto md:mx-0 mb-6 floating">
                    <i class="fas fa-piggy-bank text-4xl"></i>
                </div>
                <h1 class="text-5xl font-bold mb-4 gradient-text">SmartSave AI</h1>
                <p class="text-xl text-gray-300 mb-6">AI-powered spending analysis with pattern detection and smart predictions.</p>
            </div>
            
            <div class="glass rounded-3xl p-8 border border-gray-700 shadow-2xl bg-slate-900/80">
                <div class="flex gap-4 mb-6">
                    <button onclick="switchAuthMode('login')" id="tab-login" class="flex-1 py-2 rounded-xl bg-indigo-600 text-white font-semibold transition-all">Login</button>
                    <button onclick="switchAuthMode('register')" id="tab-register" class="flex-1 py-2 rounded-xl bg-gray-800 text-gray-400 font-semibold transition-all">Sign Up</button>
                </div>

                <form id="auth-form" class="space-y-4">
                    <div id="name-field" class="hidden">
                        <label class="block text-sm text-gray-400 mb-2">Full Name</label>
                        <input type="text" id="user-name" class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500 transition-colors" placeholder="John Doe">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Email Address</label>
                        <input type="email" id="user-email" class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500 transition-colors" placeholder="john@example.com" required>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Password</label>
                        <input type="password" id="user-password" class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500 transition-colors" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <button type="submit" class="w-full py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl font-bold hover:shadow-lg hover:shadow-indigo-500/30 transition-all flex items-center justify-center gap-2">
                        <span id="auth-btn-text">Login</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="fixed inset-0 z-[70] hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeDeleteModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-6 glass rounded-2xl border border-red-500/30 bg-slate-900">
            <div class="text-center">
                <div class="w-16 h-16 rounded-full bg-red-500/20 flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-trash-alt text-red-400 text-2xl"></i>
                </div>
                <h3 class="text-2xl font-bold mb-2">Delete Transaction?</h3>
                <p class="text-gray-400 mb-6">This will remove the transaction and reverse its effect on your balance. This action cannot be undone.</p>
                <div class="flex gap-3">
                    <button onclick="closeDeleteModal()" class="flex-1 py-3 rounded-xl border border-gray-600 hover:bg-gray-800 transition-all">Cancel</button>
                    <button onclick="confirmDelete()" class="flex-1 py-3 bg-red-600 hover:bg-red-700 rounded-xl font-bold transition-all">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-40 glass border-b border-gray-800 hidden" id="main-nav">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
                        <i class="fas fa-piggy-bank text-xl"></i>
                    </div>
                    <span class="text-xl font-bold gradient-text">SmartSave AI</span>
                    <span id="ai-status" class="hidden md:flex items-center gap-2 px-3 py-1 rounded-full bg-indigo-500/20 text-xs text-indigo-300 border border-indigo-500/30 ml-2">
                        <i class="fas fa-robot ai-thinking"></i> AI Active
                    </span>
                </div>
                <div class="flex items-center gap-6">
                    <div class="hidden md:flex items-center gap-2 px-4 py-2 rounded-full bg-orange-500/20 border border-orange-500/30">
                        <i class="fas fa-fire text-orange-500 streak-flame"></i>
                        <span class="font-bold text-orange-400" id="streak-display">0 Day Streak</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="openBankModal()" class="hidden sm:flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-500/20 border border-emerald-500/30 text-emerald-400 hover:bg-emerald-500/30 transition-all">
                            <i class="fas fa-plus"></i> Add Bank
                        </button>
                        
                        <div class="profile-menu-container">
                            <button class="w-10 h-10 rounded-full bg-gradient-to-r from-pink-500 to-rose-500 flex items-center justify-center hover:scale-110 transition-transform">
                                <span id="user-initial" class="font-bold">U</span>
                            </button>
                            <div class="profile-dropdown glass rounded-xl border border-gray-700 p-2 bg-slate-900">
                                <button onclick="openBudgetModal()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 text-white flex items-center gap-2 mb-1">
                                    <i class="fas fa-wallet text-blue-400"></i> Set Budget
                                </button>
                                <button onclick="openSavingsGoalModal()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 text-white flex items-center gap-2 mb-1">
                                    <i class="fas fa-piggy-bank text-emerald-400"></i> Set Savings Goal
                                </button>
                                <button onclick="showAIReport()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 text-white flex items-center gap-2 mb-1">
                                    <i class="fas fa-brain text-purple-400"></i> AI Analysis
                                </button>
                                <button onclick="logout()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 text-red-400 flex items-center gap-2">
                                    <i class="fas fa-sign-out-alt"></i> Logout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Budget Modal -->
    <div id="budget-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeBudgetModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-6 glass rounded-2xl border border-gray-700 bg-slate-900">
            <h3 class="text-2xl font-bold mb-2">Set Monthly Budget</h3>
            <p class="text-gray-400 mb-4">AI will alert you at 80% and warn on breach</p>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Monthly Budget ($)</label>
                    <input type="number" id="budget-input" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500" placeholder="2000" min="1">
                </div>
                <div class="flex gap-3 pt-2">
                    <button onclick="closeBudgetModal()" class="flex-1 py-3 rounded-xl border border-gray-600 hover:bg-gray-800 transition-all">Cancel</button>
                    <button onclick="setBudget()" class="flex-1 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl font-bold hover:shadow-lg transition-all">Set Budget</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Savings Goal Modal -->
    <div id="savings-goal-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeSavingsGoalModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-6 glass rounded-2xl border border-gray-700 bg-slate-900">
            <h3 class="text-2xl font-bold mb-2">Set Savings Target</h3>
            <p class="text-gray-400 mb-4">AI will calculate optimal daily spending</p>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Target Savings ($)</label>
                    <input type="number" id="savings-goal-input" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500" placeholder="500" min="1">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">By End of Month</label>
                    <input type="date" id="savings-date-input" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500">
                </div>
                <div class="flex gap-3 pt-2">
                    <button onclick="closeSavingsGoalModal()" class="flex-1 py-3 rounded-xl border border-gray-600 hover:bg-gray-800 transition-all">Cancel</button>
                    <button onclick="setSavingsGoal()" class="flex-1 py-3 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-xl font-bold hover:shadow-lg transition-all">Set Goal</button>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Analysis Modal -->
    <div id="ai-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeAIModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-3xl p-6 glass rounded-3xl border border-purple-500/30 bg-slate-900 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center">
                        <i class="fas fa-brain text-2xl"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold">AI Spending Analysis</h3>
                        <p class="text-sm text-gray-400">Pattern detection & behavioral insights</p>
                    </div>
                </div>
                <button onclick="closeAIModal()" class="w-10 h-10 rounded-full bg-gray-800 hover:bg-gray-700 flex items-center justify-center">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="ai-content" class="space-y-6">
                <!-- AI content injected here -->
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="pt-24 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto hidden" id="main-content">
        
        <!-- Smart Alert Banner -->
        <div id="smart-alert-banner" class="hidden mb-6 glass rounded-2xl p-4 border-l-4 slide-in">
            <div class="flex items-start gap-3">
                <i id="alert-icon" class="fas fa-exclamation-triangle text-2xl mt-1"></i>
                <div class="flex-1">
                    <h4 id="alert-title" class="font-bold text-lg mb-1">Smart Alert</h4>
                    <p id="alert-message" class="text-sm text-gray-300 mb-2">Message here</p>
                    <p id="alert-advice" class="text-xs text-emerald-400 font-semibold">Advice here</p>
                </div>
                <button onclick="dismissAlert()" class="text-gray-500 hover:text-white"><i class="fas fa-times"></i></button>
            </div>
        </div>

        <!-- AI Quick Insights -->
        <div id="ai-quick-insights" class="hidden mb-6 grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Injected by AI -->
        </div>

        <!-- Daily Limit Card -->
        <div id="daily-limit-card" class="hidden mb-6 glass rounded-2xl p-4 border border-indigo-500/30 bg-indigo-900/10 slide-in">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-xl bg-indigo-500/20 flex items-center justify-center">
                        <i class="fas fa-calculator text-indigo-400 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-400">AI Recommended Daily Limit</p>
                        <h3 class="text-2xl font-bold text-indigo-400" id="daily-limit-amount">$0</h3>
                        <p class="text-xs text-gray-500" id="days-remaining">to reach your goal</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-400">Spent Today</p>
                    <h3 class="text-2xl font-bold" id="spent-today">$0</h3>
                    <p class="text-xs" id="daily-status">On track</p>
                </div>
            </div>
        </div>

        <!-- Welcome -->
        <div class="mb-8 text-center slide-in">
            <h1 class="text-4xl md:text-5xl font-bold mb-2">Welcome, <span class="gradient-text" id="display-name">Saver</span>! üéâ</h1>
            <p class="text-gray-400 text-lg" id="smart-subtitle">AI is monitoring your spending patterns</p>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Total Savings with Chart -->
            <div class="glass rounded-2xl p-6 card-hover relative overflow-hidden lg:col-span-2">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-400 text-sm mb-1">Total Savings</p>
                        <h3 class="text-3xl font-bold text-emerald-400" id="total-savings">$0</h3>
                        <p class="text-sm mt-1" id="savings-goal-text">Goal: Not set</p>
                    </div>
                    <div class="w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center">
                        <i class="fas fa-piggy-bank text-emerald-400 text-xl"></i>
                    </div>
                </div>
                <div class="h-24 mt-4" id="savings-chart-container">
                    <div class="empty-state h-full flex items-center justify-center">
                        <p class="text-xs text-gray-500">Set a savings goal to see progress</p>
                    </div>
                </div>
            </div>

            <!-- Budget -->
            <div class="glass rounded-2xl p-6 card-hover relative overflow-hidden cursor-pointer" onclick="openBudgetModal()" id="budget-card">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-400 text-sm mb-1">Monthly Budget</p>
                        <h3 class="text-3xl font-bold text-blue-400" id="monthly-budget">Set Budget</h3>
                    </div>
                    <div class="w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center">
                        <i class="fas fa-calendar-alt text-blue-400 text-xl"></i>
                    </div>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-3 mt-2 overflow-hidden">
                    <div class="bg-gray-600 h-3 rounded-full transition-all duration-500" style="width: 0%" id="budget-progress"></div>
                </div>
                <p class="text-xs text-gray-400 mt-2" id="budget-text">Click to set budget</p>
            </div>

            <!-- Streak -->
            <div class="glass rounded-2xl p-6 card-hover relative overflow-hidden">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-400 text-sm mb-1">Current Streak</p>
                        <h3 class="text-3xl font-bold text-orange-400 flex items-center gap-2">
                            <span id="streak-count">0</span>
                            <i class="fas fa-fire text-2xl opacity-30"></i>
                        </h3>
                    </div>
                    <div class="w-12 h-12 rounded-xl bg-orange-500/20 flex items-center justify-center">
                        <i class="fas fa-trophy text-orange-400 text-xl"></i>
                    </div>
                </div>
                <p class="text-sm text-gray-400">Keep logging daily!</p>
            </div>
        </div>

        <!-- AI Insights Panel -->
        <div class="mb-8 glass rounded-2xl p-6 border border-purple-500/30 slide-in">
            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                <i class="fas fa-robot text-purple-400"></i>
                AI Insights & Recommendations
            </h3>
            <div id="ai-insights-container" class="space-y-3">
                <div class="p-4 rounded-lg bg-indigo-500/10 border border-indigo-500/20 flex items-start gap-3">
                    <i class="fas fa-info-circle text-indigo-400 mt-1"></i>
                    <p class="text-sm text-gray-300">Start adding transactions to enable AI pattern detection and personalized recommendations.</p>
                </div>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Column -->
            <div class="lg:col-span-2 space-y-8">
                
                <!-- Analytics -->
                <div class="glass rounded-2xl p-6 slide-in min-h-[400px] flex flex-col">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold flex items-center gap-2">
                            <i class="fas fa-chart-pie text-indigo-400"></i>
                            Spending Analytics
                        </h3>
                        <button onclick="showAIReport()" class="text-sm px-3 py-1 rounded-full bg-purple-500/20 text-purple-300 border border-purple-500/30 hover:bg-purple-500/30 transition-all">
                            <i class="fas fa-brain mr-1"></i> AI Analysis
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 flex-1">
                        <div class="relative h-64" id="chart-wrapper">
                            <div id="chart-container" class="h-full flex items-center justify-center">
                                <div class="empty-state text-center">
                                    <i class="fas fa-chart-pie text-4xl text-gray-600 mb-3"></i>
                                    <h4 class="text-lg font-semibold text-gray-400 mb-2">No data yet</h4>
                                    <p class="text-sm text-gray-500 mb-4">Add transactions to see analytics</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-4" id="category-breakdown">
                            <div class="empty-state text-center h-full flex flex-col items-center justify-center">
                                <i class="fas fa-list text-4xl text-gray-600 mb-3"></i>
                                <p class="text-sm text-gray-500">Categories will appear here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="space-y-8">
                
                <!-- Quick Add -->
                <div class="glass rounded-2xl p-6 slide-in">
                    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i class="fas fa-plus-circle text-emerald-400"></i>
                        Quick Add
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Amount</label>
                            <div class="relative">
                                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">$</span>
                                <input type="number" id="transaction-amount" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-8 py-3 focus:outline-none focus:border-emerald-500 transition-colors" placeholder="0.00" step="0.01">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Date</label>
                            <input type="date" id="transaction-date" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-emerald-500 transition-colors text-white">
                        </div>
                        
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Category</label>
                            <select id="transaction-category" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-emerald-500 transition-colors">
                                <option value="food">üçî Food & Dining</option>
                                <option value="shopping">üõçÔ∏è Shopping</option>
                                <option value="transport">üöó Transport</option>
                                <option value="entertainment">üé¨ Entertainment</option>
                                <option value="bills">üí° Bills</option>
                                <option value="income">üí∞ Income</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Type</label>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="setTransactionType('expense')" id="btn-expense" class="py-2 rounded-lg bg-rose-500/20 border border-rose-500 text-rose-400 font-semibold transition-all">Expense</button>
                                <button onclick="setTransactionType('income')" id="btn-income" class="py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-400 font-semibold transition-all">Income</button>
                            </div>
                        </div>
                        
                        <button onclick="addTransaction()" class="w-full py-3 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-xl font-bold hover:shadow-lg hover:shadow-emerald-500/30 transition-all flex items-center justify-center gap-2">
                            <i class="fas fa-check"></i> Add Transaction
                        </button>
                    </div>
                </div>

                <!-- Activity with Delete -->
                <div class="glass rounded-2xl p-6 slide-in">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold flex items-center gap-2">
                            <i class="fas fa-history text-blue-400"></i>
                            Recent Activity
                        </h3>
                        <span class="text-xs text-gray-500">Swipe to delete</span>
                    </div>
                    <div id="recent-activity" class="space-y-3">
                        <div class="empty-state py-8">
                            <i class="fas fa-receipt text-gray-600"></i>
                            <p class="text-sm text-gray-500">No transactions yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Notification -->
    <div id="notification" class="fixed bottom-4 right-4 z-50 hidden">
        <div class="glass rounded-xl p-4 border border-emerald-500/30 flex items-center gap-3 notification bg-slate-900">
            <div class="w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center">
                <i class="fas fa-check text-emerald-400"></i>
            </div>
            <div>
                <p class="font-bold text-emerald-400" id="notif-title">Success!</p>
                <p class="text-sm text-gray-300" id="notif-message">Done</p>
            </div>
        </div>
    </div>

    <script>
        // State
        let currentTransactionType = 'expense';
        let selectedIcon = '‚úàÔ∏è';
        let streakCount = 0;
        let savings = 0;
        let currentUser = null;
        let connectedBanks = [];
        let transactions = [];
        let goals = [];
        let spendingChart = null;
        let savingsChart = null;
        let monthlyBudget = 0;
        let budgetSpent = 0;
        let savingsGoal = { amount: 0, deadline: null, dailyLimit: 0 };
        let alertShown = { eighty: false, breached: false };
        let transactionToDelete = null;
        
        // AI State
        let aiPatterns = {
            spendingVelocity: [],
            categoryTrends: {},
            dayOfWeekPattern: {},
            unusualSpending: [],
            predictions: {}
        };

        function initDatePicker() {
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('transaction-date');
            const savingsDateInput = document.getElementById('savings-date-input');
            
            if (dateInput) {
                dateInput.value = today;
                dateInput.max = today;
            }
            
            if (savingsDateInput) {
                const lastDay = new Date();
                lastDay.setMonth(lastDay.getMonth() + 1);
                lastDay.setDate(0);
                savingsDateInput.value = lastDay.toISOString().split('T')[0];
                savingsDateInput.min = today;
            }
        }

        // Delete Functions
        function openDeleteModal(id) {
            transactionToDelete = id;
            document.getElementById('delete-modal').classList.remove('hidden');
        }

        function closeDeleteModal() {
            document.getElementById('delete-modal').classList.add('hidden');
            transactionToDelete = null;
        }

        function confirmDelete() {
            if (!transactionToDelete) return;
            
            const index = transactions.findIndex(t => t.id === transactionToDelete);
            if (index === -1) {
                closeDeleteModal();
                return;
            }
            
            const transaction = transactions[index];
            
            // Reverse the transaction effects
            if (transaction.type === 'income') {
                savings -= transaction.amount;
            } else {
                savings += transaction.amount;
                budgetSpent -= transaction.amount;
            }
            
            // Remove from array
            transactions.splice(index, 1);
            
            // Update all displays
            updateSavingsDisplay();
            updateBudgetDisplay();
            updateDailySpending();
            updateTransactionsUI();
            updateChartWithData();
            runAIAnalysis(); // Re-run AI without deleted transaction
            
            closeDeleteModal();
            showNotification('Deleted', 'Transaction removed and balance corrected', 'success');
        }

        // AI Analysis System
        function runAIAnalysis() {
            if (transactions.length < 3) {
                document.getElementById('ai-insights-container').innerHTML = `
                    <div class="p-4 rounded-lg bg-indigo-500/10 border border-indigo-500/20 flex items-start gap-3">
                        <i class="fas fa-info-circle text-indigo-400 mt-1"></i>
                        <p class="text-sm text-gray-300">Add at least 3 transactions for AI pattern detection.</p>
                    </div>
                `;
                return;
            }

            document.getElementById('ai-status').classList.remove('hidden');
            
            // Analyze patterns
            analyzeSpendingPatterns();
            detectAnomalies();
            generatePredictions();
            generateAIInsights();
        }

        function analyzeSpendingPatterns() {
            const expenses = transactions.filter(t => t.type === 'expense');
            
            // Category trends
            aiPatterns.categoryTrends = {};
            expenses.forEach(t => {
                if (!aiPatterns.categoryTrends[t.category]) {
                    aiPatterns.categoryTrends[t.category] = { count: 0, total: 0, dates: [] };
                }
                aiPatterns.categoryTrends[t.category].count++;
                aiPatterns.categoryTrends[t.category].total += t.amount;
                aiPatterns.categoryTrends[t.category].dates.push(new Date(t.date));
            });
            
            // Day of week pattern
            aiPatterns.dayOfWeekPattern = {};
            expenses.forEach(t => {
                const day = new Date(t.date).getDay();
                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                const dayName = dayNames[day];
                
                if (!aiPatterns.dayOfWeekPattern[dayName]) {
                    aiPatterns.dayOfWeekPattern[dayName] = { count: 0, total: 0 };
                }
                aiPatterns.dayOfWeekPattern[dayName].count++;
                aiPatterns.dayOfWeekPattern[dayName].total += t.amount;
            });
            
            // Spending velocity (average per day)
            const dates = expenses.map(t => new Date(t.date).toDateString());
            const uniqueDates = [...new Set(dates)];
            const totalSpent = expenses.reduce((sum, t) => sum + t.amount, 0);
            aiPatterns.spendingVelocity = uniqueDates.length > 0 ? totalSpent / uniqueDates.length : 0;
        }

        function detectAnomalies() {
            const expenses = transactions.filter(t => t.type === 'expense');
            if (expenses.length < 3) return;
            
            // Calculate average and standard deviation
            const amounts = expenses.map(t => t.amount);
            const avg = amounts.reduce((a, b) => a + b, 0) / amounts.length;
            const variance = amounts.reduce((sum, val) => sum + Math.pow(val - avg, 2), 0) / amounts.length;
            const stdDev = Math.sqrt(variance);
            
            // Flag transactions > 2 standard deviations
            aiPatterns.unusualSpending = expenses.filter(t => t.amount > avg + (2 * stdDev)).map(t => ({
                ...t,
                severity: t.amount > avg + (3 * stdDev) ? 'high' : 'medium'
            }));
        }

        function generatePredictions() {
            if (transactions.length < 5) return;
            
            const expenses = transactions.filter(t => t.type === 'expense');
            const daysWithData = [...new Set(expenses.map(t => new Date(t.date).toDateString()))].length;
            
            if (daysWithData < 3) return;
            
            // Predict monthly spend based on current pace
            const avgDailySpend = expenses.reduce((sum, t) => sum + t.amount, 0) / daysWithData;
            const daysInMonth = 30;
            const projectedMonthly = avgDailySpend * daysInMonth;
            
            // Predict if budget will be exceeded
            aiPatterns.predictions = {
                projectedMonthlySpend: projectedMonthly,
                willExceedBudget: monthlyBudget > 0 && projectedMonthly > monthlyBudget,
                projectedOverspend: monthlyBudget > 0 ? projectedMonthly - monthlyBudget : 0,
                confidence: Math.min(daysWithData / 7, 1) // Higher confidence with more data
            };
        }

        function generateAIInsights() {
            const insights = [];
            const expenses = transactions.filter(t => t.type === 'expense');
            
            // 1. Top spending category
            const topCategory = Object.entries(aiPatterns.categoryTrends)
                .sort((a, b) => b[1].total - a[1].total)[0];
            
            if (topCategory) {
                const percentage = ((topCategory[1].total / expenses.reduce((s, t) => s + t.amount, 0)) * 100).toFixed(0);
                insights.push({
                    icon: 'fa-chart-pie',
                    color: 'purple',
                    title: 'Top Spending Category',
                    text: `${topCategory[0].charAt(0).toUpperCase() + topCategory[0].slice(1)} accounts for ${percentage}% of your spending ($${topCategory[1].total.toFixed(0)}).`,
                    action: percentage > 40 ? 'Consider reducing this category to save more.' : null
                });
            }
            
            // 2. Day of week pattern
            const topDay = Object.entries(aiPatterns.dayOfWeekPattern)
                .sort((a, b) => b[1].total - a[1].total)[0];
            if (topDay && topDay[1].count > 2) {
                insights.push({
                    icon: 'fa-calendar-day',
                    color: 'blue',
                    title: 'Spending Pattern Detected',
                    text: `You tend to spend most on ${topDay[0]}s ($${topDay[1].total.toFixed(0)} total).`,
                    action: 'Try planning ahead for these high-spend days.'
                });
            }
            
            // 3. Unusual spending alerts
            aiPatterns.unusualSpending.slice(0, 2).forEach(unusual => {
                insights.push({
                    icon: 'fa-exclamation-circle',
                    color: unusual.severity === 'high' ? 'red' : 'yellow',
                    title: unusual.severity === 'high' ? '‚ö†Ô∏è Unusual High Spend' : 'Noticeable Spend',
                    text: `$${unusual.amount.toFixed(2)} on ${unusual.merchant} is ${unusual.severity === 'high' ? 'significantly' : ''} higher than your average.`,
                    action: 'Review if this was necessary or a one-time expense.'
                });
            });
            
            // 4. Budget prediction
            if (aiPatterns.predictions.willExceedBudget) {
                insights.push({
                    icon: 'fa-trending-up',
                    color: 'red',
                    title: 'üö® Budget Risk Alert',
                    text: `At current pace, you'll spend $${aiPatterns.predictions.projectedMonthlySpend.toFixed(0)} this month.`,
                    action: `Cut $${(aiPatterns.predictions.projectedOverspend / 30).toFixed(0)}/day to stay within budget.`
                });
            } else if (aiPatterns.predictions.projectedMonthlySpend > 0 && monthlyBudget > 0) {
                const remaining = monthlyBudget - aiPatterns.predictions.projectedMonthlySpend;
                insights.push({
                    icon: 'fa-check-circle',
                    color: 'emerald',
                    title: '‚úÖ On Track',
                    text: `Projected to stay $${remaining.toFixed(0)} under budget this month.`,
                    action: 'Great job! Consider putting the extra into savings.'
                });
            }
            
            // 5. Velocity insight
            if (aiPatterns.spendingVelocity > 50) {
                insights.push({
                    icon: 'fa-tachometer-alt',
                    color: 'orange',
                    title: 'Spending Velocity',
                    text: `Average $${aiPatterns.spendingVelocity.toFixed(0)}/day spending rate.`,
                    action: aiPatterns.spendingVelocity > 100 ? 'This is high - watch for unnecessary purchases.' : null
                });
            }
            
            // 6. Savings recommendation
            if (savingsGoal.amount > 0 && savings < savingsGoal.amount) {
                const remaining = savingsGoal.amount - savings;
                const daysLeft = Math.max(1, Math.ceil((new Date(savingsGoal.deadline) - new Date()) / (1000 * 60 * 60 * 24)));
                const dailyNeeded = remaining / daysLeft;
                
                if (dailyNeeded > savingsGoal.dailyLimit * 0.5) {
                    insights.push({
                        icon: 'fa-piggy-bank',
                        color: 'emerald',
                        title: 'Savings Optimization',
                        text: `Need $${dailyNeeded.toFixed(0)}/day more to hit goal.`,
                        action: 'Reduce discretionary spending by 20% to make it.'
                    });
                }
            }
            
            // Render insights
            const container = document.getElementById('ai-insights-container');
            container.innerHTML = insights.map(i => `
                <div class="p-4 rounded-lg ${i.color === 'red' ? 'bg-red-500/10 border border-red-500/30' : i.color === 'yellow' ? 'bg-yellow-500/10 border border-yellow-500/30' : i.color === 'emerald' ? 'bg-emerald-500/10 border border-emerald-500/30' : i.color === 'blue' ? 'bg-blue-500/10 border border-blue-500/30' : 'bg-purple-500/10 border border-purple-500/30'} flex items-start gap-3 slide-in pattern-card">
                    <i class="fas ${i.icon} ${i.color === 'red' ? 'text-red-400' : i.color === 'yellow' ? 'text-yellow-400' : i.color === 'emerald' ? 'text-emerald-400' : i.color === 'blue' ? 'text-blue-400' : 'text-purple-400'} mt-1"></i>
                    <div class="flex-1">
                        <p class="font-semibold ${i.color === 'red' ? 'text-red-200' : i.color === 'yellow' ? 'text-yellow-200' : i.color === 'emerald' ? 'text-emerald-200' : i.color === 'blue' ? 'text-blue-200' : 'text-purple-200'}">${i.title}</p>
                        <p class="text-sm text-gray-300">${i.text}</p>
                        ${i.action ? `<p class="text-xs mt-2 ${i.color === 'red' ? 'text-red-300' : 'text-emerald-300'} font-medium"><i class="fas fa-lightbulb mr-1"></i>${i.action}</p>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function showAIReport() {
            const modal = document.getElementById('ai-modal');
            const content = document.getElementById('ai-content');
            
            // Detailed AI report
            const expenses = transactions.filter(t => t.type === 'expense');
            const totalSpent = expenses.reduce((s, t) => s + t.amount, 0);
            
            let html = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="glass rounded-xl p-4 text-center">
                        <p class="text-sm text-gray-400">Transactions Analyzed</p>
                        <p class="text-2xl font-bold text-purple-400">${transactions.length}</p>
                    </div>
                    <div class="glass rounded-xl p-4 text-center">
                        <p class="text-sm text-gray-400">Pattern Confidence</p>
                        <p class="text-2xl font-bold text-purple-400">${Math.min(Math.floor(transactions.length / 10 * 100), 95)}%</p>
                    </div>
                    <div class="glass rounded-xl p-4 text-center">
                        <p class="text-sm text-gray-400">Avg Transaction</p>
                        <p class="text-2xl font-bold text-purple-400">$${expenses.length > 0 ? (totalSpent / expenses.length).toFixed(0) : 0}</p>
                    </div>
                </div>
            `;
            
            // Category breakdown with AI commentary
            if (Object.keys(aiPatterns.categoryTrends).length > 0) {
                html += `<h4 class="font-bold text-lg mb-3 text-purple-300">Category Intelligence</h4><div class="space-y-3 mb-6">`;
                
                Object.entries(aiPatterns.categoryTrends)
                    .sort((a, b) => b[1].total - a[1].total)
                    .forEach(([cat, data]) => {
                        const avg = data.total / data.count;
                        const freq = data.count > 3 ? 'frequent' : data.count === 1 ? 'one-time' : 'occasional';
                        html += `
                            <div class="glass rounded-lg p-3 flex justify-between items-center">
                                <div>
                                    <p class="font-semibold capitalize">${cat}</p>
                                    <p class="text-xs text-gray-400">${data.count} transactions ‚Ä¢ ${freq} ‚Ä¢ avg $${avg.toFixed(0)}</p>
                                </div>
                                <p class="font-bold text-purple-400">$${data.total.toFixed(0)}</p>
                            </div>
                        `;
                    });
                html += `</div>`;
            }
            
            // Behavioral predictions
            if (aiPatterns.predictions.projectedMonthlySpend) {
                html += `
                    <h4 class="font-bold text-lg mb-3 text-purple-300">AI Predictions</h4>
                    <div class="glass rounded-xl p-4 mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-gray-400">Projected Monthly Spend</span>
                            <span class="text-xl font-bold ${aiPatterns.predictions.willExceedBudget ? 'text-red-400' : 'text-emerald-400'}">$${aiPatterns.predictions.projectedMonthlySpend.toFixed(0)}</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div class="bg-purple-500 h-2 rounded-full" style="width: ${Math.min(aiPatterns.predictions.confidence * 100, 100)}%"></div>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">Confidence: ${(aiPatterns.predictions.confidence * 100).toFixed(0)}% (more data = better predictions)</p>
                    </div>
                `;
            }
            
            // Recommendations
            html += `
                <h4 class="font-bold text-lg mb-3 text-purple-300">AI Recommendations</h4>
                <ul class="space-y-2">
                    <li class="flex items-start gap-2 text-sm text-gray-300">
                        <i class="fas fa-check text-emerald-400 mt-1"></i>
                        <span>Set up automatic transfers on payday to remove temptation to spend</span>
                    </li>
                    <li class="flex items-start gap-2 text-sm text-gray-300">
                        <i class="fas fa-check text-emerald-400 mt-1"></i>
                        <span>Review subscriptions - AI detected potential recurring expenses</span>
                    </li>
                    <li class="flex items-start gap-2 text-sm text-gray-300">
                        <i class="fas fa-check text-emerald-400 mt-1"></i>
                        <span>Use the 24-hour rule for purchases over $50</span>
                    </li>
                </ul>
            `;
            
            content.innerHTML = html;
            modal.classList.remove('hidden');
        }

        function closeAIModal() {
            document.getElementById('ai-modal').classList.add('hidden');
        }

        // Budget & Savings Functions
        function openBudgetModal() {
            document.getElementById('budget-modal').classList.remove('hidden');
            document.getElementById('budget-input').focus();
        }

        function closeBudgetModal() {
            document.getElementById('budget-modal').classList.add('hidden');
        }

        function setBudget() {
            const amount = parseFloat(document.getElementById('budget-input').value);
            if (!amount || amount <= 0) {
                showNotification('Error', 'Please enter a valid budget amount', 'error');
                return;
            }
            
            monthlyBudget = amount;
            updateBudgetDisplay();
            calculateDailyLimit();
            closeBudgetModal();
            showNotification('Budget Set', `Monthly budget: $${monthlyBudget.toLocaleString()}`, 'success');
            runAIAnalysis();
        }

        function openSavingsGoalModal() {
            document.getElementById('savings-goal-modal').classList.remove('hidden');
            document.getElementById('savings-goal-input').focus();
        }

        function closeSavingsGoalModal() {
            document.getElementById('savings-goal-modal').classList.add('hidden');
        }

        function setSavingsGoal() {
            const amount = parseFloat(document.getElementById('savings-goal-input').value);
            const deadline = document.getElementById('savings-date-input').value;
            
            if (!amount || amount <= 0) {
                showNotification('Error', 'Please enter a valid savings goal', 'error');
                return;
            }
            
            savingsGoal = { amount, deadline, dailyLimit: 0 };
            calculateDailyLimit();
            updateSavingsDisplay();
            closeSavingsGoalModal();
            showNotification('Goal Set', `Save $${amount.toLocaleString()} by ${new Date(deadline).toLocaleDateString()}`, 'success');
            runAIAnalysis();
        }

        function calculateDailyLimit() {
            if (!savingsGoal.amount || !savingsGoal.deadline || monthlyBudget <= 0) {
                document.getElementById('daily-limit-card').classList.add('hidden');
                return;
            }
            
            const today = new Date();
            const deadline = new Date(savingsGoal.deadline);
            const daysLeft = Math.max(1, Math.ceil((deadline - today) / (1000 * 60 * 60 * 24)));
            
            const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
            const daysRemaining = Math.max(1, daysInMonth - today.getDate() + 1);
            
            const dailySavingsRequired = savingsGoal.amount / daysLeft;
            const dailySpendLimit = Math.max(0, (monthlyBudget - budgetSpent) / daysRemaining - dailySavingsRequired);
            
            savingsGoal.dailyLimit = dailySpendLimit;
            
            document.getElementById('daily-limit-card').classList.remove('hidden');
            document.getElementById('daily-limit-amount').textContent = `$${dailySpendLimit.toFixed(0)}`;
            document.getElementById('days-remaining').textContent = `${daysLeft} days to save $${savingsGoal.amount.toLocaleString()}`;
            
            updateDailySpending();
        }

        function updateDailySpending() {
            const today = new Date().toDateString();
            const spentToday = transactions
                .filter(t => t.type === 'expense' && new Date(t.date).toDateString() === today)
                .reduce((sum, t) => sum + t.amount, 0);
            
            document.getElementById('spent-today').textContent = `$${spentToday.toFixed(2)}`;
            
            const statusEl = document.getElementById('daily-status');
            if (savingsGoal.dailyLimit > 0) {
                const percent = (spentToday / savingsGoal.dailyLimit) * 100;
                if (percent > 100) {
                    statusEl.textContent = '‚ö†Ô∏è Over limit!';
                    statusEl.className = 'text-xs text-red-400 font-bold';
                } else if (percent > 80) {
                    statusEl.textContent = '‚ö° Approaching limit';
                    statusEl.className = 'text-xs text-yellow-400';
                } else {
                    statusEl.textContent = '‚úÖ On track';
                    statusEl.className = 'text-xs text-emerald-400';
                }
            }
        }

        // Alert System
        function checkBudgetAlerts() {
            if (monthlyBudget <= 0) return;
            
            const percentUsed = (budgetSpent / monthlyBudget) * 100;
            const banner = document.getElementById('smart-alert-banner');
            const title = document.getElementById('alert-title');
            const message = document.getElementById('alert-message');
            const advice = document.getElementById('alert-advice');
            const icon = document.getElementById('alert-icon');
            
            if (percentUsed >= 80 && percentUsed < 100 && !alertShown.eighty) {
                alertShown.eighty = true;
                banner.classList.remove('hidden', 'alert-breach');
                banner.style.borderLeftColor = '#f59e0b';
                icon.className = 'fas fa-exclamation-triangle text-2xl mt-1 text-yellow-400';
                title.textContent = '‚ö†Ô∏è Budget Alert: 80% Used';
                title.className = 'font-bold text-lg mb-1 text-yellow-400';
                message.textContent = `You've spent $${budgetSpent.toFixed(2)} of your $${monthlyBudget.toLocaleString()} budget.`;
                advice.textContent = `Daily limit reduced to $${(savingsGoal.dailyLimit * 0.5).toFixed(0)}. Consider pausing non-essential spending.`;
                showNotification('Budget Warning', 'You\'ve reached 80% of your budget!', 'warning');
            }
            
            if (percentUsed >= 100) {
                banner.classList.remove('hidden');
                banner.classList.add('alert-breach');
                banner.style.borderLeftColor = '#ef4444';
                icon.className = 'fas fa-ban text-2xl mt-1 text-red-400';
                title.textContent = 'üö® BUDGET BREACHED!';
                title.className = 'font-bold text-lg mb-1 text-red-400';
                message.textContent = `You've exceeded your $${monthlyBudget.toLocaleString()} budget by $${(budgetSpent - monthlyBudget).toFixed(2)}!`;
                
                const overspend = budgetSpent - monthlyBudget;
                const daysLeft = Math.max(1, new Date(savingsGoal.deadline || new Date().setMonth(new Date().getMonth() + 1)) - new Date()) / (1000 * 60 * 60 * 24);
                advice.textContent = `URGENT: Cut spending by $${(overspend / daysLeft + savingsGoal.dailyLimit).toFixed(0)}/day to recover.`;
                
                if (!alertShown.breached) {
                    alertShown.breached = true;
                    showNotification('BUDGET BREACHED!', 'Stop spending immediately!', 'error');
                }
            }
        }

        function dismissAlert() {
            document.getElementById('smart-alert-banner').classList.add('hidden');
        }

        // Display Functions
        function updateBudgetDisplay() {
            const budgetEl = document.getElementById('monthly-budget');
            const progressEl = document.getElementById('budget-progress');
            const textEl = document.getElementById('budget-text');
            const card = document.getElementById('budget-card');
            
            if (monthlyBudget > 0) {
                budgetEl.textContent = `$${monthlyBudget.toLocaleString()}`;
                const percent = Math.min((budgetSpent / monthlyBudget) * 100, 100);
                progressEl.style.width = percent + '%';
                
                if (percent >= 100) {
                    progressEl.className = 'h-3 rounded-full transition-all duration-500 bg-red-500 progress-bar-striped';
                    card.classList.add('alert-breach');
                } else if (percent >= 80) {
                    progressEl.className = 'h-3 rounded-full transition-all duration-500 bg-yellow-500';
                    card.classList.remove('alert-breach');
                } else {
                    progressEl.className = 'h-3 rounded-full transition-all duration-500 bg-blue-500';
                    card.classList.remove('alert-breach');
                }
                
                const remaining = monthlyBudget - budgetSpent;
                textEl.textContent = `$${budgetSpent.toLocaleString()} spent ‚Ä¢ $${remaining.toLocaleString()} left`;
                textEl.className = remaining < 0 ? 'text-xs text-red-400 font-bold' : 'text-xs text-gray-400';
            }
            
            checkBudgetAlerts();
        }

        function updateSavingsDisplay() {
            const savingsEl = document.getElementById('total-savings');
            const goalText = document.getElementById('savings-goal-text');
            
            savingsEl.textContent = `$${savings.toLocaleString()}`;
            
            if (savingsGoal.amount > 0) {
                const percent = Math.min((savings / savingsGoal.amount) * 100, 100);
                goalText.textContent = `Goal: $${savingsGoal.amount.toLocaleString()} (${percent.toFixed(0)}%)`;
                goalText.className = 'text-sm mt-1 ' + (percent >= 100 ? 'text-emerald-400 font-bold' : 'text-gray-400');
                updateSavingsChart(percent);
            }
        }

        function updateSavingsChart(percent) {
            const container = document.getElementById('savings-chart-container');
            
            if (savingsChart) {
                savingsChart.destroy();
            }
            
            container.innerHTML = '<canvas id="savingsChart"></canvas>';
            const ctx = document.getElementById('savingsChart').getContext('2d');
            
            savingsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Saved', 'Remaining'],
                    datasets: [{
                        data: [percent, 100 - percent],
                        backgroundColor: ['rgba(16, 185, 129, 0.8)', 'rgba(75, 85, 99, 0.3)'],
                        borderWidth: 0,
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false, max: 100 },
                        y: { ticks: { color: '#9ca3af', font: { size: 10 } }, grid: { display: false } }
                    }
                }
            });
        }

        // Auth
        function switchAuthMode(mode) {
            const loginTab = document.getElementById('tab-login');
            const registerTab = document.getElementById('tab-register');
            const nameField = document.getElementById('name-field');
            const btnText = document.getElementById('auth-btn-text');
            
            if (mode === 'login') {
                loginTab.className = 'flex-1 py-2 rounded-xl bg-indigo-600 text-white font-semibold transition-all';
                registerTab.className = 'flex-1 py-2 rounded-xl bg-gray-800 text-gray-400 font-semibold transition-all';
                nameField.classList.add('hidden');
                btnText.textContent = 'Login';
            } else {
                loginTab.className = 'flex-1 py-2 rounded-xl bg-gray-800 text-gray-400 font-semibold transition-all';
                registerTab.className = 'flex-1 py-2 rounded-xl bg-indigo-600 text-white font-semibold transition-all';
                nameField.classList.remove('hidden');
                btnText.textContent = 'Create Account';
            }
        }

        document.getElementById('auth-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('user-email').value;
            const name = document.getElementById('user-name').value || 'Saver';
            
            currentUser = { email, name, id: Date.now() };
            localStorage.setItem('smartsave_user', JSON.stringify(currentUser));
            
            document.getElementById('demo-background').style.display = 'none';
            document.getElementById('auth-modal').classList.add('fade-out');
            
            setTimeout(() => {
                document.getElementById('auth-modal').style.display = 'none';
                document.getElementById('main-content').classList.remove('hidden');
                document.getElementById('main-nav').classList.remove('hidden');
                document.getElementById('display-name').textContent = name;
                document.getElementById('user-initial').textContent = name[0].toUpperCase();
                
                initDatePicker();
                showNotification('Welcome!', `AI monitoring activated, ${name}!`, 'success');
            }, 500);
        });

        function logout() {
            localStorage.removeItem('smartsave_user');
            location.reload();
        }

        function openBankModal() {
            document.getElementById('bank-modal').classList.remove('hidden');
        }

        function closeBankModal() {
            document.getElementById('bank-modal').classList.add('hidden');
        }

        // Charts
        function updateChartWithData() {
            const breakdown = {};
            transactions.forEach(t => {
                if (t.type === 'expense') {
                    breakdown[t.category] = (breakdown[t.category] || 0) + t.amount;
                }
            });
            
            if (Object.keys(breakdown).length === 0) return;
            
            const chartContainer = document.getElementById('chart-container');
            chartContainer.innerHTML = '<canvas id="spendingChart"></canvas>';
            
            const labels = Object.keys(breakdown).map(c => c.charAt(0).toUpperCase() + c.slice(1));
            const data = Object.values(breakdown);
            const colors = ['rgba(244, 63, 94, 0.8)', 'rgba(59, 130, 246, 0.8)', 'rgba(16, 185, 129, 0.8)', 'rgba(139, 92, 246, 0.8)', 'rgba(245, 158, 11, 0.8)'];
            
            if (spendingChart) spendingChart.destroy();
            
            const ctx = document.getElementById('spendingChart').getContext('2d');
            spendingChart = new Chart(ctx, {
                type: 'doughnut',
                data: { labels, datasets: [{ data, backgroundColor: colors, borderWidth: 0, hoverOffset: 10 }] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { color: '#9ca3af', padding: 15, usePointStyle: true, font: { size: 11 } } } },
                    cutout: '60%'
                }
            });
            
            updateCategoryBreakdown(breakdown);
        }

        function updateCategoryBreakdown(breakdownData) {
            const container = document.getElementById('category-breakdown');
            if (!container) return;
            
            const total = Object.values(breakdownData).reduce((a, b) => a + b, 0);
            const colors = {
                food: { color: 'rose', icon: 'fa-utensils', label: 'Food & Dining' },
                shopping: { color: 'blue', icon: 'fa-shopping-bag', label: 'Shopping' },
                transport: { color: 'emerald', icon: 'fa-bus', label: 'Transport' },
                entertainment: { color: 'purple', icon: 'fa-film', label: 'Entertainment' },
                bills: { color: 'yellow', icon: 'fa-bolt', label: 'Bills' },
                others: { color: 'gray', icon: 'fa-receipt', label: 'Others' }
            };
            
            container.innerHTML = Object.entries(breakdownData)
                .sort((a, b) => b[1] - a[1])
                .map(([cat, amount]) => {
                    const config = colors[cat] || colors.others;
                    const percent = total > 0 ? ((amount / total) * 100).toFixed(0) : 0;
                    return `
                        <div class="flex items-center justify-between p-3 rounded-xl bg-gray-800/50 slide-in">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-${config.color}-500/20 flex items-center justify-center">
                                    <i class="fas ${config.icon} text-${config.color}-400"></i>
                                </div>
                                <div>
                                    <p class="font-semibold text-sm">${config.label}</p>
                                    <p class="text-xs text-gray-400">${percent}% of spending</p>
                                </div>
                            </div>
                            <span class="font-bold text-${config.color}-400">$${amount.toFixed(0)}</span>
                        </div>
                    `;
                }).join('');
        }

        // Transaction Functions
        function setTransactionType(type) {
            currentTransactionType = type;
            const expenseBtn = document.getElementById('btn-expense');
            const incomeBtn = document.getElementById('btn-income');
            
            if (type === 'expense') {
                expenseBtn.className = 'py-2 rounded-lg bg-rose-500/20 border border-rose-500 text-rose-400 font-semibold transition-all';
                incomeBtn.className = 'py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-400 font-semibold transition-all';
            } else {
                expenseBtn.className = 'py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-400 font-semibold transition-all';
                incomeBtn.className = 'py-2 rounded-lg bg-emerald-500/20 border border-emerald-500 text-emerald-400 font-semibold transition-all';
            }
        }

        function addTransaction() {
            const amount = parseFloat(document.getElementById('transaction-amount').value);
            const category = document.getElementById('transaction-category').value;
            const dateInput = document.getElementById('transaction-date').value;
            
            if (!amount || amount <= 0) {
                showNotification('Error', 'Please enter a valid amount', 'error');
                return;
            }

            const isIncome = currentTransactionType === 'income';
            const merchant = isIncome ? 'Manual Income' : `${category.charAt(0).toUpperCase() + category.slice(1)} Expense`;
            const transactionDate = dateInput ? new Date(dateInput) : new Date();
            
            transactions.unshift({
                id: Date.now(),
                merchant,
                amount,
                category,
                date: transactionDate.toISOString(),
                type: currentTransactionType
            });
            
            if (isIncome) {
                savings += amount;
            } else {
                savings -= amount;
                budgetSpent += amount;
            }
            
            updateSavingsDisplay();
            updateBudgetDisplay();
            updateDailySpending();
            updateTransactionsUI();
            updateChartWithData();
            runAIAnalysis();
            
            // Check daily limit breach
            if (!isIncome && savingsGoal.dailyLimit > 0) {
                const today = new Date().toDateString();
                const spentToday = transactions
                    .filter(t => t.type === 'expense' && new Date(t.date).toDateString() === today)
                    .reduce((sum, t) => sum + t.amount, 0);
                
                if (spentToday > savingsGoal.dailyLimit) {
                    showNotification('Daily Limit Exceeded!', `Spent $${spentToday.toFixed(2)} of $${savingsGoal.dailyLimit.toFixed(0)} limit`, 'error');
                }
            }
            
            if (transactions.length === 1) {
                updateStreak();
                showNotification('First Step!', 'AI is now monitoring your patterns', 'success');
            } else {
                showNotification('Success', 'Transaction added & analyzed by AI', 'success');
            }
            
            document.getElementById('transaction-amount').value = '';
            initDatePicker();
        }

        function updateTransactionsUI() {
            const container = document.getElementById('recent-activity');
            if (transactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state py-8">
                        <i class="fas fa-receipt text-gray-600"></i>
                        <p class="text-sm text-gray-500">No transactions yet</p>
                    </div>
                `;
                return;
            }
            
            const categoryIcons = {
                food: 'fa-coffee', shopping: 'fa-shopping-bag', transport: 'fa-bus',
                entertainment: 'fa-film', bills: 'fa-bolt', others: 'fa-receipt'
            };
            const categoryColors = {
                food: 'rose', shopping: 'blue', transport: 'emerald',
                entertainment: 'purple', bills: 'yellow', others: 'gray'
            };
            
            container.innerHTML = transactions.slice(0, 10).map(t => {
                const color = categoryColors[t.category];
                const icon = categoryIcons[t.category];
                const date = new Date(t.date);
                const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                return `
                    <div class="transaction-item flex items-center justify-between p-3 rounded-lg bg-gray-800/50 hover:bg-gray-800 transition-colors slide-in group">
                        <div class="flex items-center gap-3 flex-1">
                            <div class="w-10 h-10 rounded-full bg-${color}-500/20 flex items-center justify-center">
                                <i class="fas ${icon} text-${color}-400"></i>
                            </div>
                            <div>
                                <p class="font-semibold text-sm">${t.merchant}</p>
                                <p class="text-xs text-gray-500">${dateStr} ‚Ä¢ <span class="text-${color}-400 capitalize">${t.category}</span></p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="${t.type === 'income' ? 'text-emerald-400' : 'text-rose-400'} font-bold">${t.type === 'income' ? '+' : '-'}$${t.amount.toFixed(2)}</span>
                            <button onclick="openDeleteModal(${t.id})" class="delete-btn w-8 h-8 rounded-full bg-red-500/20 hover:bg-red-500/40 flex items-center justify-center text-red-400 transition-all">
                                <i class="fas fa-trash-alt text-sm"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateStreak() {
            streakCount = 1;
            document.getElementById('streak-count').textContent = streakCount;
            document.getElementById('streak-display').textContent = `${streakCount} Day Streak`;
            const fireIcon = document.querySelector('.fa-fire');
            if (fireIcon) {
                fireIcon.classList.remove('opacity-30');
                fireIcon.classList.add('streak-flame', 'text-orange-500');
            }
        }

        function showNotification(title, message, type = 'success') {
            const notif = document.getElementById('notification');
            const notifTitle = document.getElementById('notif-title');
            const notifMessage = document.getElementById('notif-message');
            
            const colors = { success: 'emerald', error: 'rose', info: 'blue', warning: 'yellow' };
            const color = colors[type] || 'emerald';
            
            notif.querySelector('.glass').className = `glass rounded-xl p-4 border border-${color}-500/30 flex items-center gap-3 notification bg-slate-900`;
            notif.querySelector('i').className = `fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info'} text-${color}-400`;
            notifTitle.className = `font-bold text-${color}-400`;
            
            notifTitle.textContent = title;
            notifMessage.textContent = message;
            
            notif.classList.remove('hidden');
            setTimeout(() => notif.classList.add('hidden'), type === 'error' ? 5000 : 3000);
        }

        // Load
        window.addEventListener('load', () => {
            const saved = localStorage.getItem('smartsave_user');
            if (saved) {
                currentUser = JSON.parse(saved);
                document.getElementById('demo-background').style.display = 'none';
                document.getElementById('auth-modal').style.display = 'none';
                document.getElementById('main-content').classList.remove('hidden');
                document.getElementById('main-nav').classList.remove('hidden');
                document.getElementById('display-name').textContent = currentUser.name;
                document.getElementById('user-initial').textContent = currentUser.name[0].toUpperCase();
                initDatePicker();
            }
        });
    </script>
</body>
</html>