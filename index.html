<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartSave - AI-Powered Savings Coach</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #0f172a; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .gradient-text { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .streak-flame { animation: flicker 1.5s infinite alternate; }
        @keyframes flicker { 0% { opacity: 1; transform: scale(1); } 100% { opacity: 0.8; transform: scale(1.1); } }
        .slide-in { animation: slideIn 0.5s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .pulse-glow { animation: pulseGlow 2s infinite; }
        @keyframes pulseGlow { 0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.5); } 50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.8); } }
        .confetti { position: fixed; width: 10px; height: 10px; background: #f0f; animation: confetti-fall 3s linear forwards; z-index: 9999; }
        @keyframes confetti-fall { to { transform: translateY(100vh) rotate(360deg); opacity: 0; } }
        .bank-card { transition: all 0.3s ease; cursor: pointer; }
        .bank-card:hover { transform: scale(1.05); border-color: rgba(99, 102, 241, 0.5); }
        .sync-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .fade-out { animation: fadeOut 0.5s ease-out forwards; }
        @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }
        .demo-bg { filter: blur(2px) brightness(0.4); pointer-events: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow-y: auto; z-index: 0; }
        .empty-state { text-align: center; padding: 3rem 1rem; color: #6b7280; }
        .empty-state i { font-size: 3rem; margin-bottom: 1rem; opacity: 0.5; }
        input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }
        
        /* Profile dropdown fix */
        .profile-menu-container { position: relative; }
        .profile-dropdown {
            position: absolute;
            right: 0;
            top: calc(100% + 0.5rem);
            width: 12rem;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
            z-index: 50;
        }
        .profile-menu-container:hover .profile-dropdown,
        .profile-dropdown:hover {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .profile-menu-container::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            height: 0.5rem;
            background: transparent;
        }
        
        /* Alert animations */
        .alert-breach { animation: alertPulse 1s infinite; border-color: rgba(239, 68, 68, 0.8) !important; }
        @keyframes alertPulse { 0%, 100% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.5); } 50% { box-shadow: 0 0 40px rgba(239, 68, 68, 0.8); } }
        
        .transaction-item { position: relative; }
        .delete-btn {
            opacity: 0;
            transition: all 0.2s ease;
        }
        .transaction-item:hover .delete-btn {
            opacity: 1;
        }
        
        .ai-thinking { animation: aiPulse 2s infinite; }
        @keyframes aiPulse { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
        
        .pattern-card {
            border-left: 3px solid #8b5cf6;
            background: linear-gradient(90deg, rgba(139, 92, 246, 0.1) 0%, transparent 100%);
        }
        
        .prediction-up { color: #10b981; }
        .prediction-down { color: #ef4444; }
        
        /* Date range styles */
        .date-range-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }
        .date-range-input:focus {
            outline: none;
            border-color: rgba(99, 102, 241, 0.5);
        }
        
        /* Goal icon selector */
        .goal-icon-option {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .goal-icon-option:hover {
            transform: scale(1.1);
            background: rgba(99, 102, 241, 0.2);
        }
        .goal-icon-option.selected {
            background: rgba(99, 102, 241, 0.4);
            border-color: #818cf8;
        }
        
        /* Settings styles */
        .settings-option {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .settings-option:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        .settings-option.selected {
            background: rgba(99, 102, 241, 0.2);
            border-color: #818cf8;
        }
        .currency-flag {
            font-size: 1.5rem;
            margin-right: 0.75rem;
        }
    </style>
</head>
<body class="text-white min-h-screen overflow-x-hidden">

    <!-- Confetti Container -->
    <div id="confetti-container"></div>

    <!-- DEMO BACKGROUND -->
    <div id="demo-background" class="demo-bg">
        <div class="pt-24 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto opacity-50">
            <div class="mb-8">
                <h1 class="text-4xl md:text-5xl font-bold mb-2">Welcome back, <span class="gradient-text">Demo User</span>! üéØ</h1>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/90 backdrop-blur-sm">
        <div class="w-full max-w-4xl grid md:grid-cols-2 gap-8 items-center relative z-10">
            <div class="text-center md:text-left">
                <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center mx-auto md:mx-0 mb-6 floating">
                    <i class="fas fa-piggy-bank text-4xl"></i>
                </div>
                <h1 class="text-5xl font-bold mb-4 gradient-text">SmartSave AI</h1>
                <p class="text-xl text-gray-300 mb-6" data-i18n="tagline">AI-powered spending analysis with pattern detection and smart predictions.</p>
            </div>
            
            <div class="glass rounded-3xl p-8 border border-gray-700 shadow-2xl bg-slate-900/80">
                <div class="flex gap-4 mb-6">
                    <button onclick="switchAuthMode('login')" id="tab-login" class="flex-1 py-2 rounded-xl bg-indigo-600 text-white font-semibold transition-all" data-i18n="login">Login</button>
                    <button onclick="switchAuthMode('register')" id="tab-register" class="flex-1 py-2 rounded-xl bg-gray-800 text-gray-400 font-semibold transition-all" data-i18n="signup">Sign Up</button>
                </div>

                <form id="auth-form" class="space-y-4">
                    <div id="name-field" class="hidden">
                        <label class="block text-sm text-gray-400 mb-2" data-i18n="fullName">Full Name</label>
                        <input type="text" id="user-name" class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500 transition-colors" placeholder="John Doe">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2" data-i18n="email">Email Address</label>
                        <input type="email" id="user-email" class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500 transition-colors" placeholder="john@example.com" required>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2" data-i18n="password">Password</label>
                        <input type="password" id="user-password" class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500 transition-colors" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <button type="submit" class="w-full py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl font-bold hover:shadow-lg hover:shadow-indigo-500/30 transition-all flex items-center justify-center gap-2">
                        <span id="auth-btn-text" data-i18n="login">Login</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="fixed inset-0 z-[70] hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeDeleteModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-6 glass rounded-2xl border border-red-500/30 bg-slate-900">
            <div class="text-center">
                <div class="w-16 h-16 rounded-full bg-red-500/20 flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-trash-alt text-red-400 text-2xl"></i>
                </div>
                <h3 class="text-2xl font-bold mb-2" data-i18n="deleteConfirm">Delete Transaction?</h3>
                <p class="text-gray-400 mb-6" data-i18n="deleteDesc">This will remove the transaction and reverse its effect on your balances. This action cannot be undone.</p>
                <div class="flex gap-3">
                    <button onclick="closeDeleteModal()" class="flex-1 py-3 rounded-xl border border-gray-600 hover:bg-gray-800 transition-all" data-i18n="cancel">Cancel</button>
                    <button onclick="confirmDelete()" class="flex-1 py-3 bg-red-600 hover:bg-red-700 rounded-xl font-bold transition-all" data-i18n="delete">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 z-[70] hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeSettingsModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg p-6 glass rounded-2xl border border-gray-700 bg-slate-900 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
                        <i class="fas fa-cog text-white text-xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold" data-i18n="settings">Settings</h3>
                </div>
                <button onclick="closeSettingsModal()" class="w-10 h-10 rounded-full bg-gray-800 hover:bg-gray-700 flex items-center justify-center">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <!-- Language Section -->
                <div>
                    <h4 class="text-sm font-semibold text-gray-400 mb-3 uppercase tracking-wider" data-i18n="language">Language</h4>
                    <div class="grid grid-cols-2 gap-3">
                        <div onclick="selectLanguage('en')" id="lang-option-en" class="settings-option p-4 rounded-xl border border-gray-700 flex items-center gap-3">
                            <span class="text-2xl">üá∫üá∏</span>
                            <div>
                                <p class="font-semibold">English</p>
                                <p class="text-xs text-gray-400">United States</p>
                            </div>
                        </div>
                        <div onclick="selectLanguage('pt')" id="lang-option-pt" class="settings-option p-4 rounded-xl border border-gray-700 flex items-center gap-3">
                            <span class="text-2xl">üáßüá∑</span>
                            <div>
                                <p class="font-semibold">Portugu√™s</p>
                                <p class="text-xs text-gray-400">Brasil</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Currency Section -->
                <div>
                    <h4 class="text-sm font-semibold text-gray-400 mb-3 uppercase tracking-wider" data-i18n="currency">Currency</h4>
                    <div class="space-y-2">
                        <div onclick="selectCurrency('USD')" id="currency-option-USD" class="settings-option p-4 rounded-xl border border-gray-700 flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="currency-flag">üá∫üá∏</span>
                                <div>
                                    <p class="font-semibold">USD</p>
                                    <p class="text-xs text-gray-400">US Dollar</p>
                                </div>
                            </div>
                            <span class="text-gray-400">$</span>
                        </div>
                        <div onclick="selectCurrency('BRL')" id="currency-option-BRL" class="settings-option p-4 rounded-xl border border-gray-700 flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="currency-flag">üáßüá∑</span>
                                <div>
                                    <p class="font-semibold">BRL</p>
                                    <p class="text-xs text-gray-400">Brazilian Real</p>
                                </div>
                            </div>
                            <span class="text-gray-400">R$</span>
                        </div>
                        <div onclick="selectCurrency('EUR')" id="currency-option-EUR" class="settings-option p-4 rounded-xl border border-gray-700 flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="currency-flag">üá™üá∫</span>
                                <div>
                                    <p class="font-semibold">EUR</p>
                                    <p class="text-xs text-gray-400">Euro</p>
                                </div>
                            </div>
                            <span class="text-gray-400">‚Ç¨</span>
                        </div>
                        <div onclick="selectCurrency('GBP')" id="currency-option-GBP" class="settings-option p-4 rounded-xl border border-gray-700 flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="currency-flag">üá¨üáß</span>
                                <div>
                                    <p class="font-semibold">GBP</p>
                                    <p class="text-xs text-gray-400">British Pound</p>
                                </div>
                            </div>
                            <span class="text-gray-400">¬£</span>
                        </div>
                    </div>
                </div>

                <button onclick="saveSettings()" class="w-full py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl font-bold hover:shadow-lg transition-all" data-i18n="saveSettings">
                    Save Settings
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-40 glass border-b border-gray-800 hidden" id="main-nav">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
                        <i class="fas fa-piggy-bank text-xl"></i>
                    </div>
                    <span class="text-xl font-bold gradient-text">SmartSave AI</span>
                    <span id="ai-status" class="hidden md:flex items-center gap-2 px-3 py-1 rounded-full bg-indigo-500/20 text-xs text-indigo-300 border border-indigo-500/30 ml-2">
                        <i class="fas fa-robot ai-thinking"></i> AI Active
                    </span>
                </div>
                <div class="flex items-center gap-6">
                    <div class="hidden md:flex items-center gap-2 px-4 py-2 rounded-full bg-orange-500/20 border border-orange-500/30">
                        <i class="fas fa-fire text-orange-500 streak-flame"></i>
                        <span class="font-bold text-orange-400" id="streak-display">0 Day Streak</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="openBankModal()" class="hidden sm:flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-500/20 border border-emerald-500/30 text-emerald-400 hover:bg-emerald-500/30 transition-all">
                            <i class="fas fa-plus"></i> <span data-i18n="addBank">Add Bank</span>
                        </button>
                        
                        <div class="profile-menu-container">
                            <button class="w-10 h-10 rounded-full bg-gradient-to-r from-pink-500 to-rose-500 flex items-center justify-center hover:scale-110 transition-transform">
                                <span id="user-initial" class="font-bold">U</span>
                            </button>
                            <div class="profile-dropdown glass rounded-xl border border-gray-700 p-2 bg-slate-900">
                                <button onclick="openBudgetModal()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 text-white flex items-center gap-2 mb-1">
                                    <i class="fas fa-wallet text-blue-400"></i> <span data-i18n="setBudget">Set Budget</span>
                                </button>
                                <button onclick="openSavingsGoalModal()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 text-white flex items-center gap-2 mb-1">
                                    <i class="fas fa-piggy-bank text-emerald-400"></i> <span data-i18n="setSavingsGoal">Set Savings Goal</span>
                                </button>
                                <button onclick="showAIReport()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 text-white flex items-center gap-2 mb-1">
                                    <i class="fas fa-brain text-purple-400"></i> <span data-i18n="aiAnalysis">AI Analysis</span>
                                </button>
                                <div class="border-t border-gray-700 my-1"></div>
                                <button onclick="openSettingsModal()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 text-white flex items-center gap-2 mb-1">
                                    <i class="fas fa-cog text-gray-400"></i> <span data-i18n="settings">Settings</span>
                                </button>
                                <button onclick="logout()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 text-red-400 flex items-center gap-2">
                                    <i class="fas fa-sign-out-alt"></i> <span data-i18n="logout">Logout</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Budget Modal -->
    <div id="budget-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeBudgetModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-6 glass rounded-2xl border border-gray-700 bg-slate-900">
            <h3 class="text-2xl font-bold mb-2" data-i18n="setMonthlyBudget">Set Monthly Budget</h3>
            <p class="text-gray-400 mb-4" data-i18n="aiWillAlert">AI will alert you at 80% and warn on breach</p>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2" data-i18n="monthlyBudget">Monthly Budget</label>
                    <div class="relative">
                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 currency-symbol">$</span>
                        <input type="number" id="budget-input" class="w-full bg-gray-800 border border-gray-700 rounded-xl pl-10 pr-4 py-3 focus:outline-none focus:border-indigo-500" placeholder="2000" min="1">
                    </div>
                </div>
                <div class="flex gap-3 pt-2">
                    <button onclick="closeBudgetModal()" class="flex-1 py-3 rounded-xl border border-gray-600 hover:bg-gray-800 transition-all" data-i18n="cancel">Cancel</button>
                    <button onclick="setBudget()" class="flex-1 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl font-bold hover:shadow-lg transition-all" data-i18n="setBudget">Set Budget</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Savings Goal Modal -->
    <div id="savings-goal-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeSavingsGoalModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg p-6 glass rounded-2xl border border-gray-700 bg-slate-900 max-h-[90vh] overflow-y-auto">
            <h3 class="text-2xl font-bold mb-2" data-i18n="setSavingsTarget">Set Savings Target</h3>
            <p class="text-gray-400 mb-4" data-i18n="aiWillCalculate">AI will calculate optimal monthly savings</p>
            <div class="space-y-4">
                <!-- Goal Name -->
                <div>
                    <label class="block text-sm text-gray-400 mb-2" data-i18n="goalName">Goal Name</label>
                    <input type="text" id="savings-goal-name" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500" placeholder="e.g., Trip to Japan">
                </div>
                
                <!-- Goal Description -->
                <div>
                    <label class="block text-sm text-gray-400 mb-2" data-i18n="goalDescription">Description (Optional)</label>
                    <textarea id="savings-goal-desc" rows="2" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500 resize-none" placeholder="Dream vacation with friends..."></textarea>
                </div>
                
                <!-- Icon Selector -->
                <div>
                    <label class="block text-sm text-gray-400 mb-2" data-i18n="chooseIcon">Choose Icon</label>
                    <div class="grid grid-cols-6 gap-2" id="goal-icon-selector">
                        <div class="goal-icon-option selected w-10 h-10 rounded-lg border border-gray-600 flex items-center justify-center text-xl" data-icon="fa-plane" onclick="selectGoalIcon(this)">‚úàÔ∏è</div>
                        <div class="goal-icon-option w-10 h-10 rounded-lg border border-gray-600 flex items-center justify-center text-xl" data-icon="fa-shopping-bag" onclick="selectGoalIcon(this)">üõçÔ∏è</div>
                        <div class="goal-icon-option w-10 h-10 rounded-lg border border-gray-600 flex items-center justify-center text-xl" data-icon="fa-car" onclick="selectGoalIcon(this)">üöó</div>
                        <div class="goal-icon-option w-10 h-10 rounded-lg border border-gray-600 flex items-center justify-center text-xl" data-icon="fa-home" onclick="selectGoalIcon(this)">üè†</div>
                        <div class="goal-icon-option w-10 h-10 rounded-lg border border-gray-600 flex items-center justify-center text-xl" data-icon="fa-graduation-cap" onclick="selectGoalIcon(this)">üéì</div>
                        <div class="goal-icon-option w-10 h-10 rounded-lg border border-gray-600 flex items-center justify-center text-xl" data-icon="fa-heart" onclick="selectGoalIcon(this)">‚ù§Ô∏è</div>
                        <div class="goal-icon-option w-10 h-10 rounded-lg border border-gray-600 flex items-center justify-center text-xl" data-icon="fa-gamepad" onclick="selectGoalIcon(this)">üéÆ</div>
                        <div class="goal-icon-option w-10 h-10 rounded-lg border border-gray-600 flex items-center justify-center text-xl" data-icon="fa-laptop" onclick="selectGoalIcon(this)">üíª</div>
                        <div class="goal-icon-option w-10 h-10 rounded-lg border border-gray-600 flex items-center justify-center text-xl" data-icon="fa-bicycle" onclick="selectGoalIcon(this)">üö≤</div>
                        <div class="goal-icon-option w-10 h-10 rounded-lg border border-gray-600 flex items-center justify-center text-xl" data-icon="fa-camera" onclick="selectGoalIcon(this)">üì∑</div>
                        <div class="goal-icon-option w-10 h-10 rounded-lg border border-gray-600 flex items-center justify-center text-xl" data-icon="fa-gift" onclick="selectGoalIcon(this)">üéÅ</div>
                        <div class="goal-icon-option w-10 h-10 rounded-lg border border-gray-600 flex items-center justify-center text-xl" data-icon="fa-piggy-bank" onclick="selectGoalIcon(this)">üê∑</div>
                    </div>
                    <input type="hidden" id="selected-goal-icon" value="fa-plane">
                </div>
                
                <div>
                    <label class="block text-sm text-gray-400 mb-2" data-i18n="targetSavings">Target Savings</label>
                    <div class="relative">
                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 currency-symbol">$</span>
                        <input type="number" id="savings-goal-input" class="w-full bg-gray-800 border border-gray-700 rounded-xl pl-10 pr-4 py-3 focus:outline-none focus:border-indigo-500" placeholder="5000" min="1">
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2" data-i18n="targetDate">Target Date</label>
                    <input type="date" id="savings-date-input" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500">
                </div>
                <!-- Monthly calculation preview -->
                <div id="monthly-calc-preview" class="p-4 rounded-xl bg-emerald-500/10 border border-emerald-500/20 hidden">
                    <p class="text-sm text-emerald-300 mb-1" data-i18n="requiredMonthlySavings">Required Monthly Savings:</p>
                    <p class="text-2xl font-bold text-emerald-400" id="monthly-required">$0</p>
                    <p class="text-xs text-gray-400 mt-1" id="months-until">0 months to reach goal</p>
                </div>
                <div class="flex gap-3 pt-2">
                    <button onclick="closeSavingsGoalModal()" class="flex-1 py-3 rounded-xl border border-gray-600 hover:bg-gray-800 transition-all" data-i18n="cancel">Cancel</button>
                    <button onclick="setSavingsGoal()" class="flex-1 py-3 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-xl font-bold hover:shadow-lg transition-all" data-i18n="setGoal">Set Goal</button>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Analysis Modal -->
    <div id="ai-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeAIModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-3xl p-6 glass rounded-3xl border border-purple-500/30 bg-slate-900 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center">
                        <i class="fas fa-brain text-2xl"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold" data-i18n="aiSpendingAnalysis">AI Spending Analysis</h3>
                        <p class="text-sm text-gray-400" data-i18n="patternDetection">Pattern detection & behavioral insights</p>
                    </div>
                </div>
                <button onclick="closeAIModal()" class="w-10 h-10 rounded-full bg-gray-800 hover:bg-gray-700 flex items-center justify-center">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="ai-content" class="space-y-6">
                <!-- AI content injected here -->
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="pt-24 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto hidden" id="main-content">
        
        <!-- Smart Alert Banner -->
        <div id="smart-alert-banner" class="hidden mb-6 glass rounded-2xl p-4 border-l-4 slide-in">
            <div class="flex items-start gap-3">
                <i id="alert-icon" class="fas fa-exclamation-triangle text-2xl mt-1"></i>
                <div class="flex-1">
                    <h4 id="alert-title" class="font-bold text-lg mb-1">Smart Alert</h4>
                    <p id="alert-message" class="text-sm text-gray-300 mb-2">Message here</p>
                    <p id="alert-advice" class="text-xs text-emerald-400 font-semibold">Advice here</p>
                </div>
                <button onclick="dismissAlert()" class="text-gray-500 hover:text-white"><i class="fas fa-times"></i></button>
            </div>
        </div>

        <!-- AI Quick Insights -->
        <div id="ai-quick-insights" class="hidden mb-6 grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Injected by AI -->
        </div>

        <!-- Welcome -->
        <div class="mb-8 text-center slide-in">
            <h1 class="text-4xl md:text-5xl font-bold mb-2"><span data-i18n="welcome">Welcome</span>, <span class="gradient-text" id="display-name">Saver</span>! üéâ</h1>
            <p class="text-gray-400 text-lg" id="smart-subtitle" data-i18n="aiMonitoring">AI is monitoring your spending patterns</p>
        </div>

        <!-- Stats Grid - NEW FINANCIAL MODEL -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Available Balance (Cash) -->
            <div class="glass rounded-2xl p-6 card-hover relative overflow-hidden">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-400 text-sm mb-1" data-i18n="availableBalance">Available Balance</p>
                        <h3 class="text-3xl font-bold text-indigo-400" id="available-balance">$0</h3>
                        <p class="text-sm mt-1 text-gray-400" data-i18n="whatYouCanSpend">What you can spend now</p>
                    </div>
                    <div class="w-12 h-12 rounded-xl bg-indigo-500/20 flex items-center justify-center">
                        <i class="fas fa-wallet text-indigo-400 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Savings Balance (Reserved) -->
            <div class="glass rounded-2xl p-6 card-hover relative overflow-hidden">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-400 text-sm mb-1" data-i18n="savingsBalance">Savings Balance</p>
                        <h3 class="text-3xl font-bold text-emerald-400" id="savings-balance">$0</h3>
                        <p class="text-sm mt-1 text-gray-400" data-i18n="reservedForGoals">Reserved for goals</p>
                    </div>
                    <div class="w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center">
                        <i class="fas fa-piggy-bank text-emerald-400 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Budget -->
            <div class="glass rounded-2xl p-6 card-hover relative overflow-hidden cursor-pointer" onclick="openBudgetModal()" id="budget-card">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-400 text-sm mb-1" data-i18n="monthlyBudget">Monthly Budget</p>
                        <h3 class="text-3xl font-bold text-blue-400" id="monthly-budget" data-i18n="setBudgetBtn">Set Budget</h3>
                    </div>
                    <div class="w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center">
                        <i class="fas fa-calendar-alt text-blue-400 text-xl"></i>
                    </div>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-3 mt-2 overflow-hidden">
                    <div class="bg-gray-600 h-3 rounded-full transition-all duration-500" style="width: 0%" id="budget-progress"></div>
                </div>
                <p class="text-xs text-gray-400 mt-2" id="budget-text" data-i18n="clickToSet">Click to set budget</p>
            </div>

            <!-- Streak -->
            <div class="glass rounded-2xl p-6 card-hover relative overflow-hidden">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-400 text-sm mb-1" data-i18n="currentStreak">Current Streak</p>
                        <h3 class="text-3xl font-bold text-orange-400 flex items-center gap-2">
                            <span id="streak-count">0</span>
                            <i class="fas fa-fire text-2xl opacity-30"></i>
                        </h3>
                    </div>
                    <div class="w-12 h-12 rounded-xl bg-orange-500/20 flex items-center justify-center">
                        <i class="fas fa-trophy text-orange-400 text-xl"></i>
                    </div>
                </div>
                <p class="text-sm text-gray-400" data-i18n="keepLogging">Keep logging daily!</p>
            </div>
        </div>

        <!-- Daily Limit Card -->
        <div id="daily-limit-card" class="hidden mb-6 glass rounded-2xl p-4 border border-indigo-500/30 bg-indigo-900/10 slide-in">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-xl bg-indigo-500/20 flex items-center justify-center">
                        <i class="fas fa-calculator text-indigo-400 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-400" data-i18n="aiDailyLimit">AI Recommended Daily Limit</p>
                        <h3 class="text-2xl font-bold text-indigo-400" id="daily-limit-amount">$0</h3>
                        <p class="text-xs text-gray-500" id="days-remaining">to reach your goal</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-400" data-i18n="spentToday">Spent Today</p>
                    <h3 class="text-2xl font-bold" id="spent-today">$0</h3>
                    <p class="text-xs" id="daily-status">On track</p>
                </div>
            </div>
        </div>

        <!-- Enhanced Savings Goal Tracker Section -->
        <div id="savings-goal-section" class="mb-8 glass rounded-2xl p-6 border border-emerald-500/30 bg-emerald-900/5 slide-in hidden">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                <div class="flex items-center gap-4">
                    <div id="goal-icon-display" class="w-16 h-16 rounded-2xl bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center text-3xl shadow-lg shadow-emerald-500/20">
                        ‚úàÔ∏è
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-white" id="goal-name-display">Trip to Japan</h3>
                        <p class="text-sm text-gray-400" id="goal-desc-display">Dream vacation with friends</p>
                        <p class="text-xs text-emerald-400 mt-1">
                            <span data-i18n="target">Target</span>: <span id="goal-target-display" class="font-semibold">$0</span> 
                            <span data-i18n="by">by</span> <span id="goal-date-display" class="font-semibold">-</span>
                        </p>
                    </div>
                </div>
                <button onclick="openSavingsGoalModal()" class="px-4 py-2 rounded-lg bg-emerald-500/20 border border-emerald-500/30 text-emerald-400 hover:bg-emerald-500/30 transition-all text-sm font-semibold">
                    <i class="fas fa-edit mr-2"></i><span data-i18n="editGoal">Edit Goal</span>
                </button>
            </div>
            
            <!-- Progress Bar -->
            <div class="mb-6">
                <div class="flex justify-between text-sm mb-2">
                    <span class="text-gray-400" data-i18n="progress">Progress</span>
                    <span class="text-emerald-400 font-bold" id="goal-progress-text">0%</span>
                </div>
                <div class="w-full bg-gray-700/50 rounded-full h-4 overflow-hidden">
                    <div id="goal-progress-bar-main" class="bg-gradient-to-r from-emerald-500 to-teal-400 h-4 rounded-full transition-all duration-1000 relative" style="width: 0%">
                        <div class="absolute inset-0 bg-white/20 animate-pulse"></div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="glass rounded-xl p-4 text-center border border-white/5">
                    <p class="text-xs text-gray-400 mb-1" data-i18n="monthlyNeed">Monthly Need</p>
                    <p class="text-2xl font-bold text-emerald-400" id="goal-monthly-need">$0</p>
                    <p class="text-xs text-gray-500 mt-1" data-i18n="toReachTarget">to reach target</p>
                </div>
                <div class="glass rounded-xl p-4 text-center border border-white/5">
                    <p class="text-xs text-gray-400 mb-1" data-i18n="savedSoFar">Saved So Far</p>
                    <p class="text-2xl font-bold text-white" id="goal-current-display">$0</p>
                    <p class="text-xs text-gray-500 mt-1" id="goal-amount-remaining">$0 remaining</p>
                </div>
                <div class="glass rounded-xl p-4 text-center border border-white/5">
                    <p class="text-xs text-gray-400 mb-1" data-i18n="timeLeft">Time Left</p>
                    <p class="text-2xl font-bold text-indigo-400" id="goal-time-remaining">0 months</p>
                    <p class="text-xs text-gray-500 mt-1" id="goal-deadline-days">0 days</p>
                </div>
            </div>
        </div>

        <!-- AI Insights Panel -->
        <div class="mb-8 glass rounded-2xl p-6 border border-purple-500/30 slide-in">
            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                <i class="fas fa-robot text-purple-400"></i>
                <span data-i18n="aiInsights">AI Insights & Recommendations</span>
            </h3>
            <div id="ai-insights-container" class="space-y-3">
                <div class="p-4 rounded-lg bg-indigo-500/10 border border-indigo-500/20 flex items-start gap-3">
                    <i class="fas fa-info-circle text-indigo-400 mt-1"></i>
                    <p class="text-sm text-gray-300" data-i18n="startAdding">Start adding transactions to enable AI pattern detection and personalized recommendations.</p>
                </div>
            </div>
        </div>

        <!-- Date Range Filter Bar -->
        <div class="mb-6 glass rounded-2xl p-4 flex flex-col sm:flex-row items-center gap-4 slide-in">
            <div class="flex items-center gap-2 text-gray-300">
                <i class="fas fa-calendar-range text-indigo-400"></i>
                <span class="font-semibold" data-i18n="monitorPeriod">Monitor Period:</span>
            </div>
            <div class="flex flex-wrap items-center gap-3 flex-1">
                <div class="flex items-center gap-2">
                    <label class="text-xs text-gray-400" data-i18n="from">From:</label>
                    <input type="date" id="monitor-start-date" class="date-range-input">
                </div>
                <div class="flex items-center gap-2">
                    <label class="text-xs text-gray-400" data-i18n="to">To:</label>
                    <input type="date" id="monitor-end-date" class="date-range-input">
                </div>
                <button onclick="applyDateFilter()" class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-semibold transition-all">
                    <i class="fas fa-filter mr-2"></i><span data-i18n="apply">Apply</span>
                </button>
                <button onclick="resetDateFilter()" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white text-sm transition-all">
                    <i class="fas fa-undo mr-2"></i><span data-i18n="reset">Reset</span>
                </button>
            </div>
            <div class="text-xs text-gray-400" id="filtered-stats" data-i18n="showingAll">
                Showing all transactions
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Column -->
            <div class="lg:col-span-2 space-y-8">
                
                <!-- Analytics -->
                <div class="glass rounded-2xl p-6 slide-in min-h-[400px] flex flex-col">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold flex items-center gap-2">
                            <i class="fas fa-chart-pie text-indigo-400"></i>
                            <span data-i18n="spendingAnalytics">Spending Analytics</span>
                        </h3>
                        <button onclick="showAIReport()" class="text-sm px-3 py-1 rounded-full bg-purple-500/20 text-purple-300 border border-purple-500/30 hover:bg-purple-500/30 transition-all">
                            <i class="fas fa-brain mr-1"></i> <span data-i18n="aiAnalysis">AI Analysis</span>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 flex-1">
                        <div class="relative h-64" id="chart-wrapper">
                            <div id="chart-container" class="h-full flex items-center justify-center">
                                <div class="empty-state text-center">
                                    <i class="fas fa-chart-pie text-4xl text-gray-600 mb-3"></i>
                                    <h4 class="text-lg font-semibold text-gray-400 mb-2" data-i18n="noData">No data yet</h4>
                                    <p class="text-sm text-gray-500 mb-4" data-i18n="addTransactions">Add transactions to see analytics</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-4" id="category-breakdown">
                            <div class="empty-state text-center h-full flex flex-col items-center justify-center">
                                <i class="fas fa-list text-4xl text-gray-600 mb-3"></i>
                                <p class="text-sm text-gray-500" data-i18n="categoriesAppear">Categories will appear here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="space-y-8">
                
                <!-- Quick Add -->
                <div class="glass rounded-2xl p-6 slide-in">
                    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i class="fas fa-plus-circle text-emerald-400"></i>
                        <span data-i18n="quickAdd">Quick Add</span>
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-2" data-i18n="amount">Amount</label>
                            <div class="relative">
                                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 currency-symbol">$</span>
                                <input type="number" id="transaction-amount" class="w-full bg-gray-800 border border-gray-700 rounded-xl pl-10 pr-4 py-3 focus:outline-none focus:border-emerald-500 transition-colors" placeholder="0.00" step="0.01">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm text-gray-400 mb-2" data-i18n="date">Date</label>
                            <input type="date" id="transaction-date" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-emerald-500 transition-colors text-white">
                        </div>
                        
                        <div>
                            <label class="block text-sm text-gray-400 mb-2" data-i18n="category">Category</label>
                            <select id="transaction-category" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-emerald-500 transition-colors">
                                <option value="food">üçî <span data-i18n="food">Food & Dining</span></option>
                                <option value="shopping">üõçÔ∏è <span data-i18n="shopping">Shopping</span></option>
                                <option value="transport">üöó <span data-i18n="transport">Transport</span></option>
                                <option value="entertainment">üé¨ <span data-i18n="entertainment">Entertainment</span></option>
                                <option value="bills">üí° <span data-i18n="bills">Bills</span></option>
                                <option value="income">üí∞ <span data-i18n="income">Income</span></option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm text-gray-400 mb-2" data-i18n="type">Type</label>
                            <div class="grid grid-cols-3 gap-2">
                                <button onclick="setTransactionType('expense')" id="btn-expense" class="py-2 rounded-lg bg-rose-500/20 border border-rose-500 text-rose-400 font-semibold transition-all text-xs" data-i18n="expense">Expense</button>
                                <button onclick="setTransactionType('income')" id="btn-income" class="py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-400 font-semibold transition-all text-xs" data-i18n="incomeBtn">Income</button>
                                <button onclick="setTransactionType('saveToGoal')" id="btn-saveToGoal" class="py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-400 font-semibold transition-all text-xs" data-i18n="saveToGoal">Save to Goal</button>
                            </div>
                        </div>
                        
                        <button onclick="addTransaction()" class="w-full py-3 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-xl font-bold hover:shadow-lg hover:shadow-emerald-500/30 transition-all flex items-center justify-center gap-2">
                            <i class="fas fa-check"></i> <span data-i18n="addTransaction">Add Transaction</span>
                        </button>
                    </div>
                </div>

                <!-- Activity with Delete -->
                <div class="glass rounded-2xl p-6 slide-in">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold flex items-center gap-2">
                            <i class="fas fa-history text-blue-400"></i>
                            <span data-i18n="recentActivity">Recent Activity</span>
                        </h3>
                        <span class="text-xs text-gray-500" data-i18n="swipeToDelete">Swipe to delete</span>
                    </div>
                    <div id="recent-activity" class="space-y-3">
                        <div class="empty-state py-8">
                            <i class="fas fa-receipt text-gray-600"></i>
                            <p class="text-sm text-gray-500" data-i18n="noTransactions">No transactions yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Notification -->
    <div id="notification" class="fixed bottom-4 right-4 z-50 hidden">
        <div class="glass rounded-xl p-4 border border-emerald-500/30 flex items-center gap-3 notification bg-slate-900">
            <div class="w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center">
                <i class="fas fa-check text-emerald-400"></i>
            </div>
            <div>
                <p class="font-bold text-emerald-400" id="notif-title">Success!</p>
                <p class="text-sm text-gray-300" id="notif-message">Done</p>
            </div>
        </div>
    </div>

    <script>
        // Translations
        const translations = {
            en: {
                tagline: "AI-powered spending analysis with pattern detection and smart predictions.",
                login: "Login",
                signup: "Sign Up",
                fullName: "Full Name",
                email: "Email Address",
                password: "Password",
                deleteConfirm: "Delete Transaction?",
                deleteDesc: "This will remove the transaction and reverse its effect on your balances. This action cannot be undone.",
                cancel: "Cancel",
                delete: "Delete",
                addBank: "Add Bank",
                setBudget: "Set Budget",
                setSavingsGoal: "Set Savings Goal",
                aiAnalysis: "AI Analysis",
                logout: "Logout",
                setMonthlyBudget: "Set Monthly Budget",
                aiWillAlert: "AI will alert you at 80% and warn on breach",
                monthlyBudget: "Monthly Budget",
                setSavingsTarget: "Set Savings Target",
                aiWillCalculate: "AI will calculate optimal monthly savings",
                goalName: "Goal Name",
                goalDescription: "Description (Optional)",
                chooseIcon: "Choose Icon",
                targetSavings: "Target Savings",
                targetDate: "Target Date",
                requiredMonthlySavings: "Required Monthly Savings:",
                setGoal: "Set Goal",
                aiSpendingAnalysis: "AI Spending Analysis",
                patternDetection: "Pattern detection & behavioral insights",
                welcome: "Welcome",
                aiMonitoring: "AI is monitoring your spending patterns",
                availableBalance: "Available Balance",
                whatYouCanSpend: "What you can spend now",
                savingsBalance: "Savings Balance",
                reservedForGoals: "Reserved for goals",
                setBudgetBtn: "Set Budget",
                clickToSet: "Click to set budget",
                currentStreak: "Current Streak",
                keepLogging: "Keep logging daily!",
                target: "Target",
                by: "by",
                editGoal: "Edit Goal",
                progress: "Progress",
                monthlyNeed: "Monthly Need",
                toReachTarget: "to reach target",
                savedSoFar: "Saved So Far",
                timeLeft: "Time Left",
                aiInsights: "AI Insights & Recommendations",
                startAdding: "Start adding transactions to enable AI pattern detection and personalized recommendations.",
                monitorPeriod: "Monitor Period:",
                from: "From:",
                to: "To:",
                apply: "Apply",
                reset: "Reset",
                showingAll: "Showing all transactions",
                spendingAnalytics: "Spending Analytics",
                noData: "No data yet",
                addTransactions: "Add transactions to see analytics",
                categoriesAppear: "Categories will appear here",
                quickAdd: "Quick Add",
                amount: "Amount",
                date: "Date",
                category: "Category",
                food: "Food & Dining",
                shopping: "Shopping",
                transport: "Transport",
                entertainment: "Entertainment",
                bills: "Bills",
                income: "Income",
                type: "Type",
                expense: "Expense",
                incomeBtn: "Income",
                saveToGoal: "Save to Goal",
                addTransaction: "Add Transaction",
                recentActivity: "Recent Activity",
                swipeToDelete: "Swipe to delete",
                noTransactions: "No transactions yet",
                aiDailyLimit: "AI Recommended Daily Limit",
                spentToday: "Spent Today",
                settings: "Settings",
                language: "Language",
                currency: "Currency",
                saveSettings: "Save Settings"
            },
            pt: {
                tagline: "An√°lise de gastos com IA, detec√ß√£o de padr√µes e previs√µes inteligentes.",
                login: "Entrar",
                signup: "Cadastrar",
                fullName: "Nome Completo",
                email: "E-mail",
                password: "Senha",
                deleteConfirm: "Excluir Transa√ß√£o?",
                deleteDesc: "Isso remover√° a transa√ß√£o e reverter√° seu efeito nos saldos. Esta a√ß√£o n√£o pode ser desfeita.",
                cancel: "Cancelar",
                delete: "Excluir",
                addBank: "Adicionar Banco",
                setBudget: "Definir Or√ßamento",
                setSavingsGoal: "Definir Meta de Economia",
                aiAnalysis: "An√°lise de IA",
                logout: "Sair",
                setMonthlyBudget: "Definir Or√ßamento Mensal",
                aiWillAlert: "A IA alertar√° em 80% e avisar√° se ultrapassar",
                monthlyBudget: "Or√ßamento Mensal",
                setSavingsTarget: "Definir Meta de Economia",
                aiWillCalculate: "A IA calcular√° a economia mensal ideal",
                goalName: "Nome da Meta",
                goalDescription: "Descri√ß√£o (Opcional)",
                chooseIcon: "Escolher √çcone",
                targetSavings: "Meta de Economia",
                targetDate: "Data Alvo",
                requiredMonthlySavings: "Economia Mensal Necess√°ria:",
                setGoal: "Definir Meta",
                aiSpendingAnalysis: "An√°lise de Gastos com IA",
                patternDetection: "Detec√ß√£o de padr√µes e insights comportamentais",
                welcome: "Bem-vindo",
                aiMonitoring: "A IA est√° monitorando seus padr√µes de gastos",
                availableBalance: "Saldo Dispon√≠vel",
                whatYouCanSpend: "O que voc√™ pode gastar agora",
                savingsBalance: "Saldo de Economia",
                reservedForGoals: "Reservado para metas",
                setBudgetBtn: "Definir Or√ßamento",
                clickToSet: "Clique para definir or√ßamento",
                currentStreak: "Sequ√™ncia Atual",
                keepLogging: "Continue registrando diariamente!",
                target: "Meta",
                by: "at√©",
                editGoal: "Editar Meta",
                progress: "Progresso",
                monthlyNeed: "Necessidade Mensal",
                toReachTarget: "para atingir a meta",
                savedSoFar: "Economizado At√© Agora",
                timeLeft: "Tempo Restante",
                aiInsights: "Insights e Recomenda√ß√µes da IA",
                startAdding: "Comece a adicionar transa√ß√µes para habilitar a detec√ß√£o de padr√µes e recomenda√ß√µes personalizadas.",
                monitorPeriod: "Per√≠odo de Monitoramento:",
                from: "De:",
                to: "At√©:",
                apply: "Aplicar",
                reset: "Limpar",
                showingAll: "Mostrando todas as transa√ß√µes",
                spendingAnalytics: "An√°lise de Gastos",
                noData: "Sem dados ainda",
                addTransactions: "Adicione transa√ß√µes para ver a an√°lise",
                categoriesAppear: "Categorias aparecer√£o aqui",
                quickAdd: "Adi√ß√£o R√°pida",
                amount: "Valor",
                date: "Data",
                category: "Categoria",
                food: "Comida & Restaurantes",
                shopping: "Compras",
                transport: "Transporte",
                entertainment: "Entretenimento",
                bills: "Contas",
                income: "Receita",
                type: "Tipo",
                expense: "Despesa",
                incomeBtn: "Receita",
                saveToGoal: "Guardar na Meta",
                addTransaction: "Adicionar Transa√ß√£o",
                recentActivity: "Atividade Recente",
                swipeToDelete: "Deslize para excluir",
                noTransactions: "Nenhuma transa√ß√£o ainda",
                aiDailyLimit: "Limite Di√°rio Recomendado pela IA",
                spentToday: "Gasto Hoje",
                settings: "Configura√ß√µes",
                language: "Idioma",
                currency: "Moeda",
                saveSettings: "Salvar Configura√ß√µes"
            }
        };

        let currentLanguage = 'en';
        let currentCurrency = 'USD';
        
        // Currency configuration
        const currencyConfig = {
            USD: { symbol: '$', locale: 'en-US', flag: 'üá∫üá∏' },
            BRL: { symbol: 'R$', locale: 'pt-BR', flag: 'üáßüá∑' },
            EUR: { symbol: '‚Ç¨', locale: 'de-DE', flag: 'üá™üá∫' },
            GBP: { symbol: '¬£', locale: 'en-GB', flag: 'üá¨üáß' }
        };

        // Temp settings for modal
        let tempSettings = { language: 'en', currency: 'USD' };

        function openSettingsModal() {
            tempSettings = { language: currentLanguage, currency: currentCurrency };
            document.getElementById('settings-modal').classList.remove('hidden');
            updateSettingsUI();
        }

        function closeSettingsModal() {
            document.getElementById('settings-modal').classList.add('hidden');
        }

        function selectLanguage(lang) {
            tempSettings.language = lang;
            updateSettingsUI();
        }

        function selectCurrency(curr) {
            tempSettings.currency = curr;
            updateSettingsUI();
        }

        function updateSettingsUI() {
            // Update language selection
            document.querySelectorAll('[id^="lang-option-"]').forEach(el => {
                el.classList.remove('selected');
            });
            document.getElementById(`lang-option-${tempSettings.language}`).classList.add('selected');
            
            // Update currency selection
            document.querySelectorAll('[id^="currency-option-"]').forEach(el => {
                el.classList.remove('selected');
            });
            document.getElementById(`currency-option-${tempSettings.currency}`).classList.add('selected');
        }

        function saveSettings() {
            currentLanguage = tempSettings.language;
            currentCurrency = tempSettings.currency;
            
            // Save to localStorage
            localStorage.setItem('smartsave_settings', JSON.stringify({ language: currentLanguage, currency: currentCurrency }));
            
            // Apply settings
            setLanguage(currentLanguage);
            updateCurrencySymbols();
            updateAllDisplays();
            
            closeSettingsModal();
            showNotification(currentLanguage === 'pt' ? 'Configura√ß√µes Salvas' : 'Settings Saved', currentLanguage === 'pt' ? 'Idioma e moeda atualizados' : 'Language and currency updated', 'success');
        }

        function updateCurrencySymbols() {
            const config = currencyConfig[currentCurrency];
            document.querySelectorAll('.currency-symbol').forEach(el => {
                el.textContent = config.symbol;
            });
        }

        function loadSettings() {
            const saved = localStorage.getItem('smartsave_settings');
            if (saved) {
                const settings = JSON.parse(saved);
                currentLanguage = settings.language || 'en';
                currentCurrency = settings.currency || 'USD';
                setLanguage(currentLanguage);
                updateCurrencySymbols();
            }
        }

        // NEW FINANCIAL MODEL - Clear separation of concerns
        let totalIncome = 0;           // Sum of all income transactions (lifetime)
        let availableBalance = 0;      // Cash available to spend = Income - Expenses - Moved to Savings
        let savingsBalance = 0;        // Money reserved for goals (locked)
        let currentUser = null;
        let transactions = [];
        let spendingChart = null;
        let monthlyBudget = 0;
        let budgetSpent = 0;           // Only tracks expenses, NOT savings transfers
        let savingsGoal = { 
            amount: 0, 
            deadline: null, 
            dailyLimit: 0, 
            name: '',
            description: '',
            icon: 'fa-plane'
        };
        let alertShown = { eighty: false, breached: false };
        let transactionToDelete = null;
        let dateFilter = { start: null, end: null };
        let currentTransactionType = 'expense';
        let streakCount = 0;
        
        let aiPatterns = {
            spendingVelocity: [],
            categoryTrends: {},
            dayOfWeekPattern: {},
            unusualSpending: [],
            predictions: {}
        };

        function formatMoney(amount) {
            const config = currencyConfig[currentCurrency];
            return new Intl.NumberFormat(config.locale, { 
                style: 'currency', 
                currency: currentCurrency 
            }).format(amount);
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
            
            // Update placeholders
            const nameInput = document.getElementById('user-name');
            const goalNameInput = document.getElementById('savings-goal-name');
            const goalDescInput = document.getElementById('savings-goal-desc');
            
            if (nameInput) nameInput.placeholder = lang === 'pt' ? 'Jo√£o Silva' : 'John Doe';
            if (goalNameInput) goalNameInput.placeholder = lang === 'pt' ? 'Ex: Viagem para o Jap√£o' : 'e.g., Trip to Japan';
            if (goalDescInput) goalDescInput.placeholder = lang === 'pt' ? 'F√©rias dos sonhos com amigos...' : 'Dream vacation with friends...';
        }

        function updateAllDisplays() {
            updateBalanceDisplays();
            updateBudgetDisplay();
            updateDailySpending();
            updateSavingsGoalDisplay();
            updateTransactionsUI();
            updateChartWithData();
        }

        function updateBalanceDisplays() {
            // Available Balance = Income - Expenses - Moved to Savings
            document.getElementById('available-balance').textContent = formatMoney(availableBalance);
            
            // Savings Balance = Reserved money for goals
            document.getElementById('savings-balance').textContent = formatMoney(savingsBalance);
        }

        function initDatePicker() {
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('transaction-date');
            const savingsDateInput = document.getElementById('savings-date-input');
            
            const thirtyDaysAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            document.getElementById('monitor-start-date').value = thirtyDaysAgo;
            document.getElementById('monitor-end-date').value = today;
            
            if (dateInput) {
                dateInput.value = today;
                dateInput.max = today;
            }
            
            if (savingsDateInput) {
                const sixMonths = new Date();
                sixMonths.setMonth(sixMonths.getMonth() + 6);
                savingsDateInput.value = sixMonths.toISOString().split('T')[0];
                savingsDateInput.min = today;
            }
        }

        function selectGoalIcon(element) {
            document.querySelectorAll('.goal-icon-option').forEach(el => {
                el.classList.remove('selected');
            });
            element.classList.add('selected');
            document.getElementById('selected-goal-icon').value = element.dataset.icon;
        }

        function openDeleteModal(id) {
            transactionToDelete = id;
            document.getElementById('delete-modal').classList.remove('hidden');
        }

        function closeDeleteModal() {
            document.getElementById('delete-modal').classList.add('hidden');
            transactionToDelete = null;
        }

        function confirmDelete() {
            if (!transactionToDelete) return;
            
            const index = transactions.findIndex(t => t.id === transactionToDelete);
            if (index === -1) {
                closeDeleteModal();
                return;
            }
            
            const transaction = transactions[index];
            
            // Reverse the transaction based on type
            if (transaction.type === 'income') {
                // Was: +Available, +TotalIncome
                // Reverse: -Available, -TotalIncome
                availableBalance -= transaction.amount;
                totalIncome -= transaction.amount;
            } else if (transaction.type === 'expense') {
                // Was: -Available, +BudgetSpent
                // Reverse: +Available, -BudgetSpent
                availableBalance += transaction.amount;
                budgetSpent -= transaction.amount;
            } else if (transaction.type === 'saveToGoal') {
                // Was: -Available, +SavingsBalance
                // Reverse: +Available, -SavingsBalance
                availableBalance += transaction.amount;
                savingsBalance -= transaction.amount;
            }
            
            transactions.splice(index, 1);
            
            updateAllDisplays();
            runAIAnalysis();
            
            closeDeleteModal();
            showNotification(currentLanguage === 'pt' ? 'Exclu√≠do' : 'Deleted', currentLanguage === 'pt' ? 'Transa√ß√£o removida' : 'Transaction removed', 'success');
        }

        function runAIAnalysis() {
            if (transactions.length < 3) {
                const msg = currentLanguage === 'pt' 
                    ? 'Adicione pelo menos 3 transa√ß√µes para habilitar a detec√ß√£o de padr√µes.' 
                    : 'Add at least 3 transactions for AI pattern detection.';
                document.getElementById('ai-insights-container').innerHTML = `
                    <div class="p-4 rounded-lg bg-indigo-500/10 border border-indigo-500/20 flex items-start gap-3">
                        <i class="fas fa-info-circle text-indigo-400 mt-1"></i>
                        <p class="text-sm text-gray-300">${msg}</p>
                    </div>
                `;
                return;
            }

            document.getElementById('ai-status').classList.remove('hidden');
            analyzeSpendingPatterns();
            detectAnomalies();
            generatePredictions();
            generateAIInsights();
        }

        function analyzeSpendingPatterns() {
            let expenses = transactions.filter(t => t.type === 'expense');
            if (dateFilter.start && dateFilter.end) {
                expenses = expenses.filter(t => t.date >= dateFilter.start && t.date <= dateFilter.end);
            }
            
            aiPatterns.categoryTrends = {};
            expenses.forEach(t => {
                if (!aiPatterns.categoryTrends[t.category]) {
                    aiPatterns.categoryTrends[t.category] = { count: 0, total: 0, dates: [] };
                }
                aiPatterns.categoryTrends[t.category].count++;
                aiPatterns.categoryTrends[t.category].total += t.amount;
                aiPatterns.categoryTrends[t.category].dates.push(new Date(t.date));
            });
            
            aiPatterns.dayOfWeekPattern = {};
            expenses.forEach(t => {
                const day = new Date(t.date).getDay();
                const dayNames = currentLanguage === 'pt' 
                    ? ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b']
                    : ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                const dayName = dayNames[day];
                
                if (!aiPatterns.dayOfWeekPattern[dayName]) {
                    aiPatterns.dayOfWeekPattern[dayName] = { count: 0, total: 0 };
                }
                aiPatterns.dayOfWeekPattern[dayName].count++;
                aiPatterns.dayOfWeekPattern[dayName].total += t.amount;
            });
            
            const dates = expenses.map(t => new Date(t.date).toDateString());
            const uniqueDates = [...new Set(dates)];
            const totalSpent = expenses.reduce((sum, t) => sum + t.amount, 0);
            aiPatterns.spendingVelocity = uniqueDates.length > 0 ? totalSpent / uniqueDates.length : 0;
        }

        function detectAnomalies() {
            let expenses = transactions.filter(t => t.type === 'expense');
            if (dateFilter.start && dateFilter.end) {
                expenses = expenses.filter(t => t.date >= dateFilter.start && t.date <= dateFilter.end);
            }
            
            if (expenses.length < 3) return;
            
            const amounts = expenses.map(t => t.amount);
            const avg = amounts.reduce((a, b) => a + b, 0) / amounts.length;
            const variance = amounts.reduce((sum, val) => sum + Math.pow(val - avg, 2), 0) / amounts.length;
            const stdDev = Math.sqrt(variance);
            
            aiPatterns.unusualSpending = expenses.filter(t => t.amount > avg + (2 * stdDev)).map(t => ({
                ...t,
                severity: t.amount > avg + (3 * stdDev) ? 'high' : 'medium'
            }));
        }

        function generatePredictions() {
            let expenses = transactions.filter(t => t.type === 'expense');
            if (dateFilter.start && dateFilter.end) {
                expenses = expenses.filter(t => t.date >= dateFilter.start && t.date <= dateFilter.end);
            }
            
            const daysWithData = [...new Set(expenses.map(t => new Date(t.date).toDateString()))].length;
            
            if (daysWithData < 3) return;
            
            const avgDailySpend = expenses.reduce((sum, t) => sum + t.amount, 0) / daysWithData;
            const projectedMonthly = avgDailySpend * 30;
            
            aiPatterns.predictions = {
                projectedMonthlySpend: projectedMonthly,
                willExceedBudget: monthlyBudget > 0 && projectedMonthly > monthlyBudget,
                projectedOverspend: monthlyBudget > 0 ? projectedMonthly - monthlyBudget : 0,
                confidence: Math.min(daysWithData / 7, 1)
            };
        }

        function generateAIInsights() {
            const insights = [];
            let expenses = transactions.filter(t => t.type === 'expense');
            if (dateFilter.start && dateFilter.end) {
                expenses = expenses.filter(t => t.date >= dateFilter.start && t.date <= dateFilter.end);
            }
            
            const topCategory = Object.entries(aiPatterns.categoryTrends)
                .sort((a, b) => b[1].total - a[1].total)[0];
            
            if (topCategory) {
                const percentage = ((topCategory[1].total / expenses.reduce((s, t) => s + t.amount, 0)) * 100).toFixed(0);
                insights.push({
                    icon: 'fa-chart-pie',
                    color: 'purple',
                    title: currentLanguage === 'pt' ? 'Categoria Principal' : 'Top Spending Category',
                    text: `${topCategory[0].charAt(0).toUpperCase() + topCategory[0].slice(1)} ${currentLanguage === 'pt' ? 'representa' : 'accounts for'} ${percentage}% ${currentLanguage === 'pt' ? 'dos seus gastos' : 'of your spending'} (${formatMoney(topCategory[1].total)}).`,
                    action: percentage > 40 ? (currentLanguage === 'pt' ? 'Considere reduzir esta categoria.' : 'Consider reducing this category.') : null
                });
            }
            
            const topDay = Object.entries(aiPatterns.dayOfWeekPattern)
                .sort((a, b) => b[1].total - a[1].total)[0];
            if (topDay && topDay[1].count > 2) {
                insights.push({
                    icon: 'fa-calendar-day',
                    color: 'blue',
                    title: currentLanguage === 'pt' ? 'Padr√£o Detectado' : 'Spending Pattern Detected',
                    text: `${currentLanguage === 'pt' ? 'Voc√™ gasta mais √†s' : 'You spend most on'} ${topDay[0]}s (${formatMoney(topDay[1].total)}).`,
                    action: currentLanguage === 'pt' ? 'Planeje com anteced√™ncia.' : 'Try planning ahead.'
                });
            }
            
            aiPatterns.unusualSpending.slice(0, 2).forEach(unusual => {
                insights.push({
                    icon: 'fa-exclamation-circle',
                    color: unusual.severity === 'high' ? 'red' : 'yellow',
                    title: unusual.severity === 'high' 
                        ? (currentLanguage === 'pt' ? '‚ö†Ô∏è Gasto Incomum' : '‚ö†Ô∏è Unusual High Spend')
                        : (currentLanguage === 'pt' ? 'Gasto Not√°vel' : 'Noticeable Spend'),
                    text: `${formatMoney(unusual.amount)} ${currentLanguage === 'pt' ? 'em' : 'on'} ${unusual.merchant} ${currentLanguage === 'pt' ? '√© maior que a m√©dia' : 'is higher than average'}.`,
                    action: currentLanguage === 'pt' ? 'Revise se foi necess√°rio.' : 'Review if necessary.'
                });
            });
            
            if (aiPatterns.predictions.willExceedBudget) {
                insights.push({
                    icon: 'fa-trending-up',
                    color: 'red',
                    title: currentLanguage === 'pt' ? 'üö® Alerta de Or√ßamento' : 'üö® Budget Risk Alert',
                    text: `${currentLanguage === 'pt' ? 'Voc√™ gastar√°' : 'You will spend'} ${formatMoney(aiPatterns.predictions.projectedMonthlySpend)} ${currentLanguage === 'pt' ? 'este m√™s' : 'this month'}.`,
                    action: `${currentLanguage === 'pt' ? 'Corte' : 'Cut'} ${formatMoney(aiPatterns.predictions.projectedOverspend / 30)}/${currentLanguage === 'pt' ? 'dia' : 'day'}.`
                });
            } else if (aiPatterns.predictions.projectedMonthlySpend > 0 && monthlyBudget > 0) {
                const remaining = monthlyBudget - aiPatterns.predictions.projectedMonthlySpend;
                insights.push({
                    icon: 'fa-check-circle',
                    color: 'emerald',
                    title: currentLanguage === 'pt' ? '‚úÖ No Caminho Certo' : '‚úÖ On Track',
                    text: `${currentLanguage === 'pt' ? 'Proje√ß√£o de' : 'Projected to stay'} ${formatMoney(remaining)} ${currentLanguage === 'pt' ? 'abaixo do or√ßamento' : 'under budget'}.`,
                    action: currentLanguage === 'pt' ? '√ìtimo trabalho!' : 'Great job!'
                });
            }
            
            if (aiPatterns.spendingVelocity > 50) {
                insights.push({
                    icon: 'fa-tachometer-alt',
                    color: 'orange',
                    title: currentLanguage === 'pt' ? 'Velocidade de Gastos' : 'Spending Velocity',
                    text: `${currentLanguage === 'pt' ? 'M√©dia de' : 'Average'} ${formatMoney(aiPatterns.spendingVelocity)}/${currentLanguage === 'pt' ? 'dia' : 'day'}.`,
                    action: aiPatterns.spendingVelocity > 100 ? (currentLanguage === 'pt' ? 'Alto - aten√ß√£o!' : 'High - watch out!') : null
                });
            }
            
            if (savingsGoal.amount > 0 && savingsBalance < savingsGoal.amount) {
                const remaining = savingsGoal.amount - savingsBalance;
                const daysLeft = Math.max(1, Math.ceil((new Date(savingsGoal.deadline) - new Date()) / (1000 * 60 * 60 * 24)));
                const dailyNeeded = remaining / daysLeft;
                
                if (dailyNeeded > savingsGoal.dailyLimit * 0.5) {
                    insights.push({
                        icon: 'fa-piggy-bank',
                        color: 'emerald',
                        title: currentLanguage === 'pt' ? 'Otimiza√ß√£o de Economia' : 'Savings Optimization',
                        text: `${currentLanguage === 'pt' ? 'Precisa de' : 'Need'} ${formatMoney(dailyNeeded)}/${currentLanguage === 'pt' ? 'dia' : 'day'} ${currentLanguage === 'pt' ? 'para atingir a meta' : 'to hit goal'}.`,
                        action: currentLanguage === 'pt' ? 'Reduza gastos em 20%.' : 'Reduce spending by 20%.'
                    });
                }
            }
            
            const container = document.getElementById('ai-insights-container');
            container.innerHTML = insights.map(i => `
                <div class="p-4 rounded-lg ${i.color === 'red' ? 'bg-red-500/10 border border-red-500/30' : i.color === 'yellow' ? 'bg-yellow-500/10 border border-yellow-500/30' : i.color === 'emerald' ? 'bg-emerald-500/10 border border-emerald-500/30' : i.color === 'blue' ? 'bg-blue-500/10 border border-blue-500/30' : 'bg-purple-500/10 border border-purple-500/30'} flex items-start gap-3 slide-in pattern-card">
                    <i class="fas ${i.icon} ${i.color === 'red' ? 'text-red-400' : i.color === 'yellow' ? 'text-yellow-400' : i.color === 'emerald' ? 'text-emerald-400' : i.color === 'blue' ? 'text-blue-400' : 'text-purple-400'} mt-1"></i>
                    <div class="flex-1">
                        <p class="font-semibold ${i.color === 'red' ? 'text-red-200' : i.color === 'yellow' ? 'text-yellow-200' : i.color === 'emerald' ? 'text-emerald-200' : i.color === 'blue' ? 'text-blue-200' : 'text-purple-200'}">${i.title}</p>
                        <p class="text-sm text-gray-300">${i.text}</p>
                        ${i.action ? `<p class="text-xs mt-2 ${i.color === 'red' ? 'text-red-300' : 'text-emerald-300'} font-medium"><i class="fas fa-lightbulb mr-1"></i>${i.action}</p>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function showAIReport() {
            const modal = document.getElementById('ai-modal');
            const content = document.getElementById('ai-content');
            
            let expenses = transactions.filter(t => t.type === 'expense');
            if (dateFilter.start && dateFilter.end) {
                expenses = expenses.filter(t => t.date >= dateFilter.start && t.date <= dateFilter.end);
            }
            const totalSpent = expenses.reduce((s, t) => s + t.amount, 0);
            
            let html = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="glass rounded-xl p-4 text-center">
                        <p class="text-sm text-gray-400">${currentLanguage === 'pt' ? 'Transa√ß√µes Analisadas' : 'Transactions Analyzed'}</p>
                        <p class="text-2xl font-bold text-purple-400">${transactions.length}</p>
                    </div>
                    <div class="glass rounded-xl p-4 text-center">
                        <p class="text-sm text-gray-400">${currentLanguage === 'pt' ? 'Confian√ßa' : 'Pattern Confidence'}</p>
                        <p class="text-2xl font-bold text-purple-400">${Math.min(Math.floor(transactions.length / 10 * 100), 95)}%</p>
                    </div>
                    <div class="glass rounded-xl p-4 text-center">
                        <p class="text-sm text-gray-400">${currentLanguage === 'pt' ? 'M√©dia por Transa√ß√£o' : 'Avg Transaction'}</p>
                        <p class="text-2xl font-bold text-purple-400">${expenses.length > 0 ? formatMoney(totalSpent / expenses.length) : formatMoney(0)}</p>
                    </div>
                </div>
            `;
            
            if (Object.keys(aiPatterns.categoryTrends).length > 0) {
                html += `<h4 class="font-bold text-lg mb-3 text-purple-300">${currentLanguage === 'pt' ? 'Intelig√™ncia de Categoria' : 'Category Intelligence'}</h4><div class="space-y-3 mb-6">`;
                
                Object.entries(aiPatterns.categoryTrends)
                    .sort((a, b) => b[1].total - a[1].total)
                    .forEach(([cat, data]) => {
                        const avg = data.total / data.count;
                        const freq = data.count > 3 ? (currentLanguage === 'pt' ? 'frequente' : 'frequent') : data.count === 1 ? (currentLanguage === 'pt' ? '√∫nico' : 'one-time') : (currentLanguage === 'pt' ? 'ocasional' : 'occasional');
                        html += `
                            <div class="glass rounded-lg p-3 flex justify-between items-center">
                                <div>
                                    <p class="font-semibold capitalize">${cat}</p>
                                    <p class="text-xs text-gray-400">${data.count} ${currentLanguage === 'pt' ? 'transa√ß√µes' : 'transactions'} ‚Ä¢ ${freq} ‚Ä¢ ${currentLanguage === 'pt' ? 'm√©dia' : 'avg'} ${formatMoney(avg)}</p>
                                </div>
                                <p class="font-bold text-purple-400">${formatMoney(data.total)}</p>
                            </div>
                        `;
                    });
                html += `</div>`;
            }
            
            if (aiPatterns.predictions.projectedMonthlySpend) {
                html += `
                    <h4 class="font-bold text-lg mb-3 text-purple-300">${currentLanguage === 'pt' ? 'Previs√µes da IA' : 'AI Predictions'}</h4>
                    <div class="glass rounded-xl p-4 mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-gray-400">${currentLanguage === 'pt' ? 'Gasto Mensal Projetado' : 'Projected Monthly Spend'}</span>
                            <span class="text-xl font-bold ${aiPatterns.predictions.willExceedBudget ? 'text-red-400' : 'text-emerald-400'}">${formatMoney(aiPatterns.predictions.projectedMonthlySpend)}</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div class="bg-purple-500 h-2 rounded-full" style="width: ${Math.min(aiPatterns.predictions.confidence * 100, 100)}%"></div>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">${currentLanguage === 'pt' ? 'Confian√ßa' : 'Confidence'}: ${(aiPatterns.predictions.confidence * 100).toFixed(0)}%</p>
                    </div>
                `;
            }
            
            html += `
                <h4 class="font-bold text-lg mb-3 text-purple-300">${currentLanguage === 'pt' ? 'Recomenda√ß√µes' : 'AI Recommendations'}</h4>
                <ul class="space-y-2">
                    <li class="flex items-start gap-2 text-sm text-gray-300">
                        <i class="fas fa-check text-emerald-400 mt-1"></i>
                        <span>${currentLanguage === 'pt' ? 'Configure transfer√™ncias autom√°ticas no dia de pagamento' : 'Set up automatic transfers on payday'}</span>
                    </li>
                    <li class="flex items-start gap-2 text-sm text-gray-300">
                        <i class="fas fa-check text-emerald-400 mt-1"></i>
                        <span>${currentLanguage === 'pt' ? 'Revise assinaturas - IA detectou despesas recorrentes' : 'Review subscriptions - AI detected recurring expenses'}</span>
                    </li>
                    <li class="flex items-start gap-2 text-sm text-gray-300">
                        <i class="fas fa-check text-emerald-400 mt-1"></i>
                        <span>${currentLanguage === 'pt' ? `Use a regra das 24 horas para compras acima de ${formatMoney(50)}` : `Use the 24-hour rule for purchases over ${formatMoney(50)}`}</span>
                    </li>
                </ul>
            `;
            
            content.innerHTML = html;
            modal.classList.remove('hidden');
        }

        function closeAIModal() {
            document.getElementById('ai-modal').classList.add('hidden');
        }

        function openBudgetModal() {
            document.getElementById('budget-modal').classList.remove('hidden');
            document.getElementById('budget-input').focus();
        }

        function closeBudgetModal() {
            document.getElementById('budget-modal').classList.add('hidden');
        }

        function setBudget() {
            const amount = parseFloat(document.getElementById('budget-input').value);
            if (!amount || amount <= 0) {
                showNotification(currentLanguage === 'pt' ? 'Erro' : 'Error', currentLanguage === 'pt' ? 'Valor inv√°lido' : 'Please enter valid amount', 'error');
                return;
            }
            
            monthlyBudget = amount;
            updateBudgetDisplay();
            calculateDailyLimit();
            closeBudgetModal();
            showNotification(currentLanguage === 'pt' ? 'Or√ßamento Definido' : 'Budget Set', `${currentLanguage === 'pt' ? 'Or√ßamento mensal' : 'Monthly budget'}: ${formatMoney(monthlyBudget)}`, 'success');
            runAIAnalysis();
        }

        function openSavingsGoalModal() {
            document.getElementById('savings-goal-modal').classList.remove('hidden');
            document.getElementById('savings-goal-name').focus();
            
            document.getElementById('savings-goal-input').addEventListener('input', updateMonthlyCalcPreview);
            document.getElementById('savings-date-input').addEventListener('change', updateMonthlyCalcPreview);
            updateMonthlyCalcPreview();
        }

        function closeSavingsGoalModal() {
            document.getElementById('savings-goal-modal').classList.add('hidden');
        }

        function updateMonthlyCalcPreview() {
            const amount = parseFloat(document.getElementById('savings-goal-input').value) || 0;
            const deadline = document.getElementById('savings-date-input').value;
            
            if (amount > 0 && deadline) {
                const today = new Date();
                const targetDate = new Date(deadline);
                const monthsLeft = Math.max(1, Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24 * 30)));
                const monthlyNeed = amount / monthsLeft;
                
                document.getElementById('monthly-calc-preview').classList.remove('hidden');
                document.getElementById('monthly-required').textContent = formatMoney(monthlyNeed);
                document.getElementById('months-until').textContent = `${monthsLeft} ${currentLanguage === 'pt' ? 'meses para atingir a meta' : 'months to reach goal'}`;
            } else {
                document.getElementById('monthly-calc-preview').classList.add('hidden');
            }
        }

        function setSavingsGoal() {
            const name = document.getElementById('savings-goal-name').value || (currentLanguage === 'pt' ? 'Minha Meta' : 'My Goal');
            const description = document.getElementById('savings-goal-desc').value || '';
            const icon = document.getElementById('selected-goal-icon').value;
            const amount = parseFloat(document.getElementById('savings-goal-input').value);
            const deadline = document.getElementById('savings-date-input').value;
            
            if (!amount || amount <= 0) {
                showNotification(currentLanguage === 'pt' ? 'Erro' : 'Error', currentLanguage === 'pt' ? 'Meta inv√°lida' : 'Please enter valid goal', 'error');
                return;
            }
            
            savingsGoal = { ...savingsGoal, name, description, icon, amount, deadline, dailyLimit: 0 };
            calculateDailyLimit();
            updateAllDisplays();
            closeSavingsGoalModal();
            showNotification(currentLanguage === 'pt' ? 'Meta Definida' : 'Goal Set', `${name}: ${formatMoney(amount)}`, 'success');
            runAIAnalysis();
        }

        function updateSavingsGoalDisplay() {
            if (savingsGoal.amount <= 0) {
                document.getElementById('savings-goal-section').classList.add('hidden');
                return;
            }
            
            document.getElementById('savings-goal-section').classList.remove('hidden');
            
            const iconMap = {
                'fa-plane': '‚úàÔ∏è', 'fa-shopping-bag': 'üõçÔ∏è', 'fa-car': 'üöó', 'fa-home': 'üè†',
                'fa-graduation-cap': 'üéì', 'fa-heart': '‚ù§Ô∏è', 'fa-gamepad': 'üéÆ', 'fa-laptop': 'üíª',
                'fa-bicycle': 'üö≤', 'fa-camera': 'üì∑', 'fa-gift': 'üéÅ', 'fa-piggy-bank': 'üê∑'
            };
            document.getElementById('goal-icon-display').textContent = iconMap[savingsGoal.icon] || '‚úàÔ∏è';
            
            document.getElementById('goal-name-display').textContent = savingsGoal.name;
            document.getElementById('goal-desc-display').textContent = savingsGoal.description || '';
            document.getElementById('goal-desc-display').style.display = savingsGoal.description ? 'block' : 'none';
            
            document.getElementById('goal-target-display').textContent = formatMoney(savingsGoal.amount);
            document.getElementById('goal-date-display').textContent = new Date(savingsGoal.deadline).toLocaleDateString(currencyConfig[currentCurrency].locale, { month: 'short', year: 'numeric' });
            document.getElementById('goal-current-display').textContent = formatMoney(savingsBalance); // Use savingsBalance, not savingsGoal.currentSavings
            
            const percentage = Math.min(100, Math.max(0, (savingsBalance / savingsGoal.amount) * 100)); // Use savingsBalance
            document.getElementById('goal-progress-text').textContent = `${percentage.toFixed(1)}%`;
            document.getElementById('goal-progress-bar-main').style.width = `${percentage}%`;
            
            const remaining = savingsGoal.amount - savingsBalance; // Use savingsBalance
            document.getElementById('goal-amount-remaining').textContent = `${formatMoney(remaining)} ${currentLanguage === 'pt' ? 'restando' : 'remaining'}`;
            
            const today = new Date();
            const targetDate = new Date(savingsGoal.deadline);
            const monthsLeft = Math.max(1, Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24 * 30)));
            const daysLeft = Math.max(1, Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24)));
            const monthlyNeed = remaining / monthsLeft;
            
            document.getElementById('goal-monthly-need').textContent = formatMoney(monthlyNeed);
            document.getElementById('goal-time-remaining').textContent = `${monthsLeft} ${currentLanguage === 'pt' ? 'meses' : 'months'}`;
            document.getElementById('goal-deadline-days').textContent = `${daysLeft} ${currentLanguage === 'pt' ? 'dias restantes' : 'days left'}`;
        }

        function calculateDailyLimit() {
            if (!savingsGoal.amount || !savingsGoal.deadline || monthlyBudget <= 0) {
                document.getElementById('daily-limit-card').classList.add('hidden');
                return;
            }
            
            const today = new Date();
            const deadline = new Date(savingsGoal.deadline);
            const daysLeft = Math.max(1, Math.ceil((deadline - today) / (1000 * 60 * 60 * 24)));
            
            const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
            const daysRemaining = Math.max(1, daysInMonth - today.getDate() + 1);
            
            const dailySavingsRequired = (savingsGoal.amount - savingsBalance) / daysLeft; // Use savingsBalance
            const dailySpendLimit = Math.max(0, (monthlyBudget - budgetSpent) / daysRemaining - dailySavingsRequired);
            
            savingsGoal.dailyLimit = dailySpendLimit;
            
            document.getElementById('daily-limit-card').classList.remove('hidden');
            document.getElementById('daily-limit-amount').textContent = formatMoney(dailySpendLimit);
            document.getElementById('days-remaining').textContent = `${daysLeft} ${currentLanguage === 'pt' ? 'dias para economizar' : 'days to save'} ${formatMoney(savingsGoal.amount)}`;
            
            updateDailySpending();
        }

        function updateDailySpending() {
            let dailyTransactions = transactions.filter(t => t.type === 'expense');
            if (dateFilter.start && dateFilter.end) {
                dailyTransactions = dailyTransactions.filter(t => t.date >= dateFilter.start && t.date <= dateFilter.end);
            }
            
            const today = new Date().toDateString();
            const spentToday = dailyTransactions
                .filter(t => new Date(t.date).toDateString() === today)
                .reduce((sum, t) => sum + t.amount, 0);
            
            document.getElementById('spent-today').textContent = formatMoney(spentToday);
            
            const statusEl = document.getElementById('daily-status');
            if (savingsGoal.dailyLimit > 0) {
                const percent = (spentToday / savingsGoal.dailyLimit) * 100;
                if (percent > 100) {
                    statusEl.textContent = currentLanguage === 'pt' ? '‚ö†Ô∏è Acima do limite!' : '‚ö†Ô∏è Over limit!';
                    statusEl.className = 'text-xs text-red-400 font-bold';
                } else if (percent > 80) {
                    statusEl.textContent = currentLanguage === 'pt' ? '‚ö° Pr√≥ximo do limite' : '‚ö° Approaching limit';
                    statusEl.className = 'text-xs text-yellow-400';
                } else {
                    statusEl.textContent = currentLanguage === 'pt' ? '‚úÖ No caminho certo' : '‚úÖ On track';
                    statusEl.className = 'text-xs text-emerald-400';
                }
            }
        }

        function checkBudgetAlerts() {
            if (monthlyBudget <= 0) return;
            
            const percentUsed = (budgetSpent / monthlyBudget) * 100;
            const banner = document.getElementById('smart-alert-banner');
            const title = document.getElementById('alert-title');
            const message = document.getElementById('alert-message');
            const advice = document.getElementById('alert-advice');
            const icon = document.getElementById('alert-icon');
            
            if (percentUsed >= 80 && percentUsed < 100 && !alertShown.eighty) {
                alertShown.eighty = true;
                banner.classList.remove('hidden', 'alert-breach');
                banner.style.borderLeftColor = '#f59e0b';
                icon.className = 'fas fa-exclamation-triangle text-2xl mt-1 text-yellow-400';
                title.textContent = currentLanguage === 'pt' ? '‚ö†Ô∏è Alerta: 80% Usado' : '‚ö†Ô∏è Budget Alert: 80% Used';
                title.className = 'font-bold text-lg mb-1 text-yellow-400';
                message.textContent = `${currentLanguage === 'pt' ? 'Voc√™ gastou' : 'You spent'} ${formatMoney(budgetSpent)} ${currentLanguage === 'pt' ? 'do seu or√ßamento de' : 'of your'} ${formatMoney(monthlyBudget)}.`;
                advice.textContent = `${currentLanguage === 'pt' ? 'Limite di√°rio reduzido. Considere pausar gastos.' : 'Daily limit reduced. Consider pausing spending.'}`;
                showNotification(currentLanguage === 'pt' ? 'Alerta de Or√ßamento' : 'Budget Warning', currentLanguage === 'pt' ? 'Voc√™ atingiu 80% do or√ßamento!' : 'You reached 80% of budget!', 'warning');
            }
            
            if (percentUsed >= 100) {
                banner.classList.remove('hidden');
                banner.classList.add('alert-breach');
                banner.style.borderLeftColor = '#ef4444';
                icon.className = 'fas fa-ban text-2xl mt-1 text-red-400';
                title.textContent = currentLanguage === 'pt' ? 'üö® OR√áAMENTO ESTOURADO!' : 'üö® BUDGET BREACHED!';
                title.className = 'font-bold text-lg mb-1 text-red-400';
                message.textContent = `${currentLanguage === 'pt' ? 'Voc√™ ultrapassou' : 'You exceeded'} ${formatMoney(monthlyBudget)} ${currentLanguage === 'pt' ? 'em' : 'by'} ${formatMoney(budgetSpent - monthlyBudget)}!`;
                
                const overspend = budgetSpent - monthlyBudget;
                const daysLeft = Math.max(1, new Date(savingsGoal.deadline || new Date().setMonth(new Date().getMonth() + 1)) - new Date()) / (1000 * 60 * 60 * 24);
                advice.textContent = `${currentLanguage === 'pt' ? 'URGENTE: Corte' : 'URGENT: Cut'} ${formatMoney((overspend / daysLeft + savingsGoal.dailyLimit))}/${currentLanguage === 'pt' ? 'dia' : 'day'}.`;
                
                if (!alertShown.breached) {
                    alertShown.breached = true;
                    showNotification(currentLanguage === 'pt' ? 'OR√áAMENTO ESTOURADO!' : 'BUDGET BREACHED!', currentLanguage === 'pt' ? 'Pare de gastar imediatamente!' : 'Stop spending immediately!', 'error');
                }
            }
        }

        function dismissAlert() {
            document.getElementById('smart-alert-banner').classList.add('hidden');
        }

        function updateBudgetDisplay() {
            const budgetEl = document.getElementById('monthly-budget');
            const progressEl = document.getElementById('budget-progress');
            const textEl = document.getElementById('budget-text');
            const card = document.getElementById('budget-card');
            
            if (monthlyBudget > 0) {
                budgetEl.textContent = formatMoney(monthlyBudget);
                const percent = Math.min((budgetSpent / monthlyBudget) * 100, 100);
                progressEl.style.width = percent + '%';
                
                if (percent >= 100) {
                    progressEl.className = 'h-3 rounded-full transition-all duration-500 bg-red-500 progress-bar-striped';
                    card.classList.add('alert-breach');
                } else if (percent >= 80) {
                    progressEl.className = 'h-3 rounded-full transition-all duration-500 bg-yellow-500';
                    card.classList.remove('alert-breach');
                } else {
                    progressEl.className = 'h-3 rounded-full transition-all duration-500 bg-blue-500';
                    card.classList.remove('alert-breach');
                }
                
                const remaining = monthlyBudget - budgetSpent;
                textEl.textContent = `${formatMoney(budgetSpent)} ${currentLanguage === 'pt' ? 'gasto' : 'spent'} ‚Ä¢ ${formatMoney(remaining)} ${currentLanguage === 'pt' ? 'restando' : 'left'}`;
                textEl.className = remaining < 0 ? 'text-xs text-red-400 font-bold' : 'text-xs text-gray-400';
            }
            
            checkBudgetAlerts();
        }

        function switchAuthMode(mode) {
            const loginTab = document.getElementById('tab-login');
            const registerTab = document.getElementById('tab-register');
            const nameField = document.getElementById('name-field');
            const btnText = document.getElementById('auth-btn-text');
            
            if (mode === 'login') {
                loginTab.className = 'flex-1 py-2 rounded-xl bg-indigo-600 text-white font-semibold transition-all';
                registerTab.className = 'flex-1 py-2 rounded-xl bg-gray-800 text-gray-400 font-semibold transition-all';
                nameField.classList.add('hidden');
                btnText.textContent = currentLanguage === 'pt' ? 'Entrar' : 'Login';
            } else {
                loginTab.className = 'flex-1 py-2 rounded-xl bg-gray-800 text-gray-400 font-semibold transition-all';
                registerTab.className = 'flex-1 py-2 rounded-xl bg-indigo-600 text-white font-semibold transition-all';
                nameField.classList.remove('hidden');
                btnText.textContent = currentLanguage === 'pt' ? 'Criar Conta' : 'Create Account';
            }
        }

        document.getElementById('auth-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('user-email').value;
            const name = document.getElementById('user-name').value || (currentLanguage === 'pt' ? 'Economizador' : 'Saver');
            
            currentUser = { email, name, id: Date.now() };
            localStorage.setItem('smartsave_user', JSON.stringify(currentUser));
            
            document.getElementById('demo-background').style.display = 'none';
            document.getElementById('auth-modal').classList.add('fade-out');
            
            setTimeout(() => {
                document.getElementById('auth-modal').style.display = 'none';
                document.getElementById('main-content').classList.remove('hidden');
                document.getElementById('main-nav').classList.remove('hidden');
                document.getElementById('display-name').textContent = name;
                document.getElementById('user-initial').textContent = name[0].toUpperCase();
                
                initDatePicker();
                loadSettings();
                showNotification(currentLanguage === 'pt' ? 'Bem-vindo!' : 'Welcome!', `${currentLanguage === 'pt' ? 'Monitoramento ativado' : 'AI monitoring activated'}, ${name}!`, 'success');
            }, 500);
        });

        function logout() {
            localStorage.removeItem('smartsave_user');
            location.reload();
        }

        function openBankModal() {
            // Placeholder - would open bank modal
            showNotification('Info', 'Bank connection feature coming soon', 'info');
        }

        function updateChartWithData() {
            let filteredTransactions = transactions;
            if (dateFilter.start && dateFilter.end) {
                filteredTransactions = transactions.filter(t => t.date >= dateFilter.start && t.date <= dateFilter.end);
            }
            
            const breakdown = {};
            filteredTransactions.forEach(t => {
                if (t.type === 'expense') {
                    breakdown[t.category] = (breakdown[t.category] || 0) + t.amount;
                }
            });
            
            if (Object.keys(breakdown).length === 0) {
                document.getElementById('chart-container').innerHTML = `
                    <div class="empty-state text-center">
                        <i class="fas fa-chart-pie text-4xl text-gray-600 mb-3"></i>
                        <h4 class="text-lg font-semibold text-gray-400 mb-2">${currentLanguage === 'pt' ? 'Sem dados ainda' : 'No data yet'}</h4>
                        <p class="text-sm text-gray-500 mb-4">${currentLanguage === 'pt' ? 'Adicione transa√ß√µes' : 'Add transactions to see analytics'}</p>
                    </div>
                `;
                return;
            }
            
            const chartContainer = document.getElementById('chart-container');
            chartContainer.innerHTML = '<canvas id="spendingChart"></canvas>';
            
            const labels = Object.keys(breakdown).map(c => {
                const catNames = currentLanguage === 'pt' ? {
                    food: 'Comida', shopping: 'Compras', transport: 'Transporte',
                    entertainment: 'Entretenimento', bills: 'Contas', others: 'Outros'
                } : {
                    food: 'Food', shopping: 'Shopping', transport: 'Transport',
                    entertainment: 'Entertainment', bills: 'Bills', others: 'Others'
                };
                return catNames[c] || c.charAt(0).toUpperCase() + c.slice(1);
            });
            
            const data = Object.values(breakdown);
            const colors = ['rgba(244, 63, 94, 0.8)', 'rgba(59, 130, 246, 0.8)', 'rgba(16, 185, 129, 0.8)', 'rgba(139, 92, 246, 0.8)', 'rgba(245, 158, 11, 0.8)'];
            
            if (spendingChart) spendingChart.destroy();
            
            const ctx = document.getElementById('spendingChart').getContext('2d');
            spendingChart = new Chart(ctx, {
                type: 'doughnut',
                data: { labels, datasets: [{ data, backgroundColor: colors, borderWidth: 0, hoverOffset: 10 }] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { color: '#9ca3af', padding: 15, usePointStyle: true, font: { size: 11 } } } },
                    cutout: '60%'
                }
            });
            
            updateCategoryBreakdown(breakdown);
        }

        function updateCategoryBreakdown(breakdownData) {
            const container = document.getElementById('category-breakdown');
            if (!container) return;
            
            const total = Object.values(breakdownData).reduce((a, b) => a + b, 0);
            const colors = {
                food: { color: 'rose', icon: 'fa-utensils', label: currentLanguage === 'pt' ? 'Comida' : 'Food & Dining' },
                shopping: { color: 'blue', icon: 'fa-shopping-bag', label: currentLanguage === 'pt' ? 'Compras' : 'Shopping' },
                transport: { color: 'emerald', icon: 'fa-bus', label: currentLanguage === 'pt' ? 'Transporte' : 'Transport' },
                entertainment: { color: 'purple', icon: 'fa-film', label: currentLanguage === 'pt' ? 'Entretenimento' : 'Entertainment' },
                bills: { color: 'yellow', icon: 'fa-bolt', label: currentLanguage === 'pt' ? 'Contas' : 'Bills' },
                others: { color: 'gray', icon: 'fa-receipt', label: currentLanguage === 'pt' ? 'Outros' : 'Others' }
            };
            
            container.innerHTML = Object.entries(breakdownData)
                .sort((a, b) => b[1] - a[1])
                .map(([cat, amount]) => {
                    const config = colors[cat] || colors.others;
                    const percent = total > 0 ? ((amount / total) * 100).toFixed(0) : 0;
                    return `
                        <div class="flex items-center justify-between p-3 rounded-xl bg-gray-800/50 slide-in">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-${config.color}-500/20 flex items-center justify-center">
                                    <i class="fas ${config.icon} text-${config.color}-400"></i>
                                </div>
                                <div>
                                    <p class="font-semibold text-sm">${config.label}</p>
                                    <p class="text-xs text-gray-400">${percent}% ${currentLanguage === 'pt' ? 'dos gastos' : 'of spending'}</p>
                                </div>
                            </div>
                            <span class="font-bold text-${config.color}-400">${formatMoney(amount)}</span>
                        </div>
                    `;
                }).join('');
        }

        function setTransactionType(type) {
            currentTransactionType = type;
            const expenseBtn = document.getElementById('btn-expense');
            const incomeBtn = document.getElementById('btn-income');
            const saveToGoalBtn = document.getElementById('btn-saveToGoal');
            
            // Reset all
            expenseBtn.className = 'py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-400 font-semibold transition-all text-xs';
            incomeBtn.className = 'py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-400 font-semibold transition-all text-xs';
            saveToGoalBtn.className = 'py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-400 font-semibold transition-all text-xs';
            
            if (type === 'expense') {
                expenseBtn.className = 'py-2 rounded-lg bg-rose-500/20 border border-rose-500 text-rose-400 font-semibold transition-all text-xs';
            } else if (type === 'income') {
                incomeBtn.className = 'py-2 rounded-lg bg-emerald-500/20 border border-emerald-500 text-emerald-400 font-semibold transition-all text-xs';
            } else if (type === 'saveToGoal') {
                saveToGoalBtn.className = 'py-2 rounded-lg bg-blue-500/20 border border-blue-500 text-blue-400 font-semibold transition-all text-xs';
            }
        }

        function addTransaction() {
            const amount = parseFloat(document.getElementById('transaction-amount').value);
            const category = document.getElementById('transaction-category').value;
            const dateInput = document.getElementById('transaction-date').value;
            
            if (!amount || amount <= 0) {
                showNotification(currentLanguage === 'pt' ? 'Erro' : 'Error', currentLanguage === 'pt' ? 'Valor inv√°lido' : 'Please enter valid amount', 'error');
                return;
            }

            const transactionDate = dateInput ? new Date(dateInput) : new Date();
            let merchant = '';
            
            // Determine merchant name based on type
            if (currentTransactionType === 'income') {
                merchant = currentLanguage === 'pt' ? 'Receita Manual' : 'Manual Income';
            } else if (currentTransactionType === 'saveToGoal') {
                merchant = currentLanguage === 'pt' ? 'Guardar na Meta' : 'Save to Goal';
            } else {
                merchant = `${category.charAt(0).toUpperCase() + category.slice(1)}`;
            }
            
            const transaction = {
                id: Date.now(),
                merchant,
                amount,
                category,
                date: transactionDate.toISOString().split('T')[0],
                type: currentTransactionType
            };
            
            transactions.unshift(transaction);
            
            // Apply transaction based on type
            if (currentTransactionType === 'income') {
                // Income: +Available, +TotalIncome
                availableBalance += amount;
                totalIncome += amount;
            } else if (currentTransactionType === 'expense') {
                // Expense: -Available, +BudgetSpent
                availableBalance -= amount;
                budgetSpent += amount;
            } else if (currentTransactionType === 'saveToGoal') {
                // Save to Goal: -Available, +SavingsBalance (NO budget impact!)
                if (amount > availableBalance) {
                    showNotification(currentLanguage === 'pt' ? 'Erro' : 'Error', currentLanguage === 'pt' ? 'Saldo insuficiente' : 'Insufficient available balance', 'error');
                    transactions.shift(); // Remove the transaction
                    return;
                }
                availableBalance -= amount;
                savingsBalance += amount;
            }
            
            updateAllDisplays();
            runAIAnalysis();
            
            // Check daily limit for expenses
            if (currentTransactionType === 'expense' && savingsGoal.dailyLimit > 0) {
                const today = new Date().toDateString();
                const spentToday = transactions
                    .filter(t => t.type === 'expense' && new Date(t.date).toDateString() === today)
                    .reduce((sum, t) => sum + t.amount, 0);
                
                if (spentToday > savingsGoal.dailyLimit) {
                    showNotification(currentLanguage === 'pt' ? 'Limite Di√°rio Excedido!' : 'Daily Limit Exceeded!', `${currentLanguage === 'pt' ? 'Gasto' : 'Spent'} ${formatMoney(spentToday)} ${currentLanguage === 'pt' ? 'de' : 'of'} ${formatMoney(savingsGoal.dailyLimit)}`, 'error');
                }
            }
            
            if (transactions.length === 1) {
                updateStreak();
                showNotification(currentLanguage === 'pt' ? 'Primeiro Passo!' : 'First Step!', currentLanguage === 'pt' ? 'IA monitorando padr√µes' : 'AI is monitoring your patterns', 'success');
            } else {
                showNotification(currentLanguage === 'pt' ? 'Sucesso' : 'Success', currentLanguage === 'pt' ? 'Transa√ß√£o adicionada' : 'Transaction added', 'success');
            }
            
            document.getElementById('transaction-amount').value = '';
            initDatePicker();
        }

        function updateTransactionsUI() {
            const container = document.getElementById('recent-activity');
            
            let filteredTransactions = transactions;
            if (dateFilter.start && dateFilter.end) {
                filteredTransactions = transactions.filter(t => t.date >= dateFilter.start && t.date <= dateFilter.end);
            }
            
            if (filteredTransactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state py-8">
                        <i class="fas fa-receipt text-gray-600"></i>
                        <p class="text-sm text-gray-500">${currentLanguage === 'pt' ? 'Nenhuma transa√ß√£o' : 'No transactions yet'}</p>
                    </div>
                `;
                return;
            }
            
            const categoryIcons = {
                food: 'fa-coffee', shopping: 'fa-shopping-bag', transport: 'fa-bus',
                entertainment: 'fa-film', bills: 'fa-bolt', others: 'fa-receipt'
            };
            const categoryColors = {
                food: 'rose', shopping: 'blue', transport: 'emerald',
                entertainment: 'purple', bills: 'yellow', others: 'gray'
            };
            const typeColors = {
                income: 'emerald',
                expense: 'rose',
                saveToGoal: 'blue'
            };
            
            container.innerHTML = filteredTransactions.slice(0, 10).map(t => {
                const color = categoryColors[t.category];
                const icon = categoryIcons[t.category];
                const typeColor = typeColors[t.type];
                const date = new Date(t.date);
                const dateStr = date.toLocaleDateString(currencyConfig[currentCurrency].locale, { month: 'short', day: 'numeric' });
                
                // Format amount display based on type
                let amountDisplay = '';
                if (t.type === 'income') {
                    amountDisplay = `<span class="text-emerald-400 font-bold">+${formatMoney(t.amount)}</span>`;
                } else if (t.type === 'saveToGoal') {
                    amountDisplay = `<span class="text-blue-400 font-bold">‚Üí ${formatMoney(t.amount)}</span>`;
                } else {
                    amountDisplay = `<span class="text-rose-400 font-bold">-${formatMoney(t.amount)}</span>`;
                }
                
                return `
                    <div class="transaction-item flex items-center justify-between p-3 rounded-lg bg-gray-800/50 hover:bg-gray-800 transition-colors slide-in group">
                        <div class="flex items-center gap-3 flex-1">
                            <div class="w-10 h-10 rounded-full bg-${typeColor}-500/20 flex items-center justify-center">
                                <i class="fas ${t.type === 'income' ? 'fa-arrow-down' : t.type === 'saveToGoal' ? 'fa-piggy-bank' : icon} text-${typeColor}-400"></i>
                            </div>
                            <div>
                                <p class="font-semibold text-sm">${t.merchant}</p>
                                <p class="text-xs text-gray-500">${dateStr} ‚Ä¢ <span class="text-${color}-400 capitalize">${t.category}</span></p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            ${amountDisplay}
                            <button onclick="openDeleteModal(${t.id})" class="delete-btn w-8 h-8 rounded-full bg-red-500/20 hover:bg-red-500/40 flex items-center justify-center text-red-400 transition-all">
                                <i class="fas fa-trash-alt text-sm"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateStreak() {
            streakCount = 1;
            document.getElementById('streak-count').textContent = streakCount;
            document.getElementById('streak-display').textContent = `${streakCount} ${currentLanguage === 'pt' ? 'Dia' : 'Day'} Streak`;
            const fireIcon = document.querySelector('.fa-fire');
            if (fireIcon) {
                fireIcon.classList.remove('opacity-30');
                fireIcon.classList.add('streak-flame', 'text-orange-500');
            }
        }

        function showNotification(title, message, type = 'success') {
            const notif = document.getElementById('notification');
            const notifTitle = document.getElementById('notif-title');
            const notifMessage = document.getElementById('notif-message');
            
            const colors = { success: 'emerald', error: 'rose', info: 'blue', warning: 'yellow' };
            const color = colors[type] || 'emerald';
            
            notif.querySelector('.glass').className = `glass rounded-xl p-4 border border-${color}-500/30 flex items-center gap-3 notification bg-slate-900`;
            notif.querySelector('i').className = `fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info'} text-${color}-400`;
            notifTitle.className = `font-bold text-${color}-400`;
            
            notifTitle.textContent = title;
            notifMessage.textContent = message;
            
            notif.classList.remove('hidden');
            setTimeout(() => notif.classList.add('hidden'), type === 'error' ? 5000 : 3000);
        }

        function applyDateFilter() {
            const start = document.getElementById('monitor-start-date').value;
            const end = document.getElementById('monitor-end-date').value;
            
            if (!start || !end) {
                showNotification(currentLanguage === 'pt' ? 'Erro' : 'Error', currentLanguage === 'pt' ? 'Selecione ambas as datas' : 'Please select both dates', 'error');
                return;
            }
            
            if (start > end) {
                showNotification(currentLanguage === 'pt' ? 'Erro' : 'Error', currentLanguage === 'pt' ? 'Data inicial n√£o pode ser posterior' : 'Start date cannot be after end', 'error');
                return;
            }
            
            dateFilter = { start, end };
            document.getElementById('filtered-stats').textContent = `${start} ${currentLanguage === 'pt' ? 'a' : 'to'} ${end}`;
            
            updateAllDisplays();
            runAIAnalysis();
            
            showNotification(currentLanguage === 'pt' ? 'Filtro Aplicado' : 'Filter Applied', `${currentLanguage === 'pt' ? 'Per√≠odo' : 'Period'}: ${start} ${currentLanguage === 'pt' ? 'a' : 'to'} ${end}`, 'success');
        }

        function resetDateFilter() {
            dateFilter = { start: null, end: null };
            initDatePicker();
            document.getElementById('filtered-stats').textContent = currentLanguage === 'pt' ? 'Mostrando todas as transa√ß√µes' : 'Showing all transactions';
            
            updateAllDisplays();
            runAIAnalysis();
            
            showNotification(currentLanguage === 'pt' ? 'Filtro Limpo' : 'Filter Reset', currentLanguage === 'pt' ? 'Mostrando todas as transa√ß√µes' : 'Showing all transactions', 'info');
        }

        window.addEventListener('load', () => {
            const saved = localStorage.getItem('smartsave_user');
            if (saved) {
                currentUser = JSON.parse(saved);
                document.getElementById('demo-background').style.display = 'none';
                document.getElementById('auth-modal').style.display = 'none';
                document.getElementById('main-content').classList.remove('hidden');
                document.getElementById('main-nav').classList.remove('hidden');
                document.getElementById('display-name').textContent = currentUser.name;
                document.getElementById('user-initial').textContent = currentUser.name[0].toUpperCase();
                initDatePicker();
                loadSettings();
            }
        });
    </script>
</body>
</html>