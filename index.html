<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartSave - AI-Powered Savings Coach</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #0f172a; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .gradient-text { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .streak-flame { animation: flicker 1.5s infinite alternate; }
        @keyframes flicker { 0% { opacity: 1; transform: scale(1); } 100% { opacity: 0.8; transform: scale(1.1); } }
        .slide-in { animation: slideIn 0.5s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .pulse-glow { animation: pulseGlow 2s infinite; }
        @keyframes pulseGlow { 0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.5); } 50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.8); } }
        .confetti { position: fixed; width: 10px; height: 10px; background: #f0f; animation: confetti-fall 3s linear forwards; z-index: 9999; }
        @keyframes confetti-fall { to { transform: translateY(100vh) rotate(360deg); opacity: 0; } }
        .bank-card { transition: all 0.3s ease; cursor: pointer; }
        .bank-card:hover { transform: scale(1.05); border-color: rgba(99, 102, 241, 0.5); }
        .sync-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .fade-out { animation: fadeOut 0.5s ease-out forwards; }
        @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }
        .demo-bg { filter: blur(2px) brightness(0.4); pointer-events: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow-y: auto; z-index: 0; }
        .empty-state { text-align: center; padding: 3rem 1rem; color: #6b7280; }
        .empty-state i { font-size: 3rem; margin-bottom: 1rem; opacity: 0.5; }
        input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }
        
        /* FIX: Profile dropdown gap issue */
        .profile-menu-container { position: relative; }
        .profile-dropdown {
            position: absolute;
            right: 0;
            top: calc(100% + 0.5rem);
            width: 12rem;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
            z-index: 50;
        }
        .profile-menu-container:hover .profile-dropdown,
        .profile-dropdown:hover {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        /* Invisible bridge to prevent gap */
        .profile-menu-container::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            height: 0.5rem;
            background: transparent;
        }
    </style>
</head>
<body class="text-white min-h-screen overflow-x-hidden">

    <!-- Confetti Container -->
    <div id="confetti-container"></div>

    <!-- DEMO BACKGROUND (Visible only when logged out) -->
    <div id="demo-background" class="demo-bg">
        <div class="pt-24 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto opacity-50">
            <div class="mb-8">
                <h1 class="text-4xl md:text-5xl font-bold mb-2">Welcome back, <span class="gradient-text">Demo User</span>! üéØ</h1>
                <p class="text-gray-400 text-lg">Your AI coach has saved you <span class="text-green-400 font-bold">$245</span> this month</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="glass rounded-2xl p-6"><div class="flex justify-between items-start"><div><p class="text-gray-400 text-sm">Total Savings</p><h3 class="text-3xl font-bold text-emerald-400">$12,450</h3></div><i class="fas fa-wallet text-emerald-400 text-xl"></i></div></div>
                <div class="glass rounded-2xl p-6"><div class="flex justify-between items-start"><div><p class="text-gray-400 text-sm">Monthly Budget</p><h3 class="text-3xl font-bold text-blue-400">$3,500</h3></div><i class="fas fa-calendar-alt text-blue-400 text-xl"></i></div><div class="w-full bg-gray-700 rounded-full h-2 mt-2"><div class="bg-blue-500 h-2 rounded-full" style="width: 65%"></div></div></div>
                <div class="glass rounded-2xl p-6"><div class="flex justify-between items-start"><div><p class="text-gray-400 text-sm">Active Goals</p><h3 class="text-3xl font-bold text-purple-400">5</h3></div><i class="fas fa-bullseye text-purple-400 text-xl"></i></div></div>
                <div class="glass rounded-2xl p-6"><div class="flex justify-between items-start"><div><p class="text-gray-400 text-sm">Current Streak</p><h3 class="text-3xl font-bold text-orange-400">24</h3></div><i class="fas fa-fire text-orange-400 text-xl streak-flame"></i></div></div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 glass rounded-2xl p-6 h-96 flex items-center justify-center">
                    <div class="text-center"><i class="fas fa-chart-pie text-6xl text-gray-600 mb-4"></i><p class="text-gray-500">Demo Analytics Preview</p></div>
                </div>
                <div class="space-y-4">
                    <div class="glass rounded-2xl p-4"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-emerald-500/20"></div><div class="flex-1"><div class="h-4 bg-gray-700 rounded w-3/4 mb-2"></div><div class="h-3 bg-gray-800 rounded w-1/2"></div></div></div></div>
                    <div class="glass rounded-2xl p-4"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-blue-500/20"></div><div class="flex-1"><div class="h-4 bg-gray-700 rounded w-3/4 mb-2"></div><div class="h-3 bg-gray-800 rounded w-1/2"></div></div></div></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/90 backdrop-blur-sm">
        <div class="w-full max-w-4xl grid md:grid-cols-2 gap-8 items-center relative z-10">
            <div class="text-center md:text-left">
                <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center mx-auto md:mx-0 mb-6 floating">
                    <i class="fas fa-piggy-bank text-4xl"></i>
                </div>
                <h1 class="text-5xl font-bold mb-4 gradient-text">SmartSave AI</h1>
                <p class="text-xl text-gray-300 mb-6">Your intelligent financial companion that connects to your bank and automatically saves money using AI.</p>
                <div class="space-y-3 hidden md:block">
                    <div class="flex items-center gap-3 text-gray-300"><i class="fas fa-check-circle text-emerald-400"></i><span>AI-Powered categorization</span></div>
                    <div class="flex items-center gap-3 text-gray-300"><i class="fas fa-check-circle text-emerald-400"></i><span>Connect unlimited bank accounts</span></div>
                    <div class="flex items-center gap-3 text-gray-300"><i class="fas fa-check-circle text-emerald-400"></i><span>Automatic savings recommendations</span></div>
                </div>
            </div>
            
            <div class="glass rounded-3xl p-8 border border-gray-700 shadow-2xl bg-slate-900/80">
                <div class="flex gap-4 mb-6">
                    <button onclick="switchAuthMode('login')" id="tab-login" class="flex-1 py-2 rounded-xl bg-indigo-600 text-white font-semibold transition-all">Login</button>
                    <button onclick="switchAuthMode('register')" id="tab-register" class="flex-1 py-2 rounded-xl bg-gray-800 text-gray-400 font-semibold transition-all">Sign Up</button>
                </div>

                <form id="auth-form" class="space-y-4">
                    <div id="name-field" class="hidden">
                        <label class="block text-sm text-gray-400 mb-2">Full Name</label>
                        <input type="text" id="user-name" class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500 transition-colors" placeholder="John Doe">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Email Address</label>
                        <input type="email" id="user-email" class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500 transition-colors" placeholder="john@example.com" required>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Password</label>
                        <input type="password" id="user-password" class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500 transition-colors" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <button type="submit" class="w-full py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl font-bold hover:shadow-lg hover:shadow-indigo-500/30 transition-all flex items-center justify-center gap-2">
                        <span id="auth-btn-text">Login</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </form>

                <div class="mt-6 pt-6 border-t border-gray-700">
                    <p class="text-center text-sm text-gray-400 mb-4">Secure 256-bit SSL Encryption</p>
                    <div class="flex justify-center gap-4 text-gray-500">
                        <i class="fas fa-shield-alt text-2xl"></i>
                        <i class="fas fa-lock text-2xl"></i>
                        <i class="fas fa-user-shield text-2xl"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bank Connection Modal -->
    <div id="bank-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeBankModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-2xl p-6 glass rounded-3xl border border-gray-700 max-h-[90vh] overflow-y-auto bg-slate-900">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 class="text-2xl font-bold">Connect Your Bank</h3>
                    <p class="text-gray-400 text-sm">Securely link your accounts for automatic tracking</p>
                </div>
                <button onclick="closeBankModal()" class="w-10 h-10 rounded-full bg-gray-800 hover:bg-gray-700 flex items-center justify-center transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div id="bank-selection">
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                    <div onclick="selectBank('Chase')" class="bank-card glass p-4 rounded-2xl border border-gray-700 flex flex-col items-center gap-3 hover:bg-gray-800">
                        <div class="w-16 h-16 rounded-full bg-blue-600 flex items-center justify-center text-2xl font-bold">C</div>
                        <span class="font-semibold">Chase</span>
                    </div>
                    <div onclick="selectBank('Bank of America')" class="bank-card glass p-4 rounded-2xl border border-gray-700 flex flex-col items-center gap-3 hover:bg-gray-800">
                        <div class="w-16 h-16 rounded-full bg-red-600 flex items-center justify-center text-2xl font-bold">B</div>
                        <span class="font-semibold">Bank of America</span>
                    </div>
                    <div onclick="selectBank('Wells Fargo')" class="bank-card glass p-4 rounded-2xl border border-gray-700 flex flex-col items-center gap-3 hover:bg-gray-800">
                        <div class="w-16 h-16 rounded-full bg-yellow-600 flex items-center justify-center text-2xl font-bold">W</div>
                        <span class="font-semibold">Wells Fargo</span>
                    </div>
                    <div onclick="selectBank('Citibank')" class="bank-card glass p-4 rounded-2xl border border-gray-700 flex flex-col items-center gap-3 hover:bg-gray-800">
                        <div class="w-16 h-16 rounded-full bg-blue-500 flex items-center justify-center text-2xl font-bold">C</div>
                        <span class="font-semibold">Citibank</span>
                    </div>
                    <div onclick="selectBank('Capital One')" class="bank-card glass p-4 rounded-2xl border border-gray-700 flex flex-col items-center gap-3 hover:bg-gray-800">
                        <div class="w-16 h-16 rounded-full bg-blue-800 flex items-center justify-center text-2xl font-bold">C</div>
                        <span class="font-semibold">Capital One</span>
                    </div>
                    <div onclick="selectBank('Other')" class="bank-card glass p-4 rounded-2xl border border-gray-700 flex flex-col items-center gap-3 hover:bg-gray-800">
                        <div class="w-16 h-16 rounded-full bg-gray-600 flex items-center justify-center text-2xl font-bold">+</div>
                        <span class="font-semibold">Other Banks</span>
                    </div>
                </div>
            </div>

            <div id="bank-login" class="hidden space-y-4">
                <div class="p-4 rounded-xl bg-indigo-500/10 border border-indigo-500/30 flex items-center gap-3 mb-4">
                    <i class="fas fa-shield-alt text-indigo-400 text-xl"></i>
                    <div>
                        <p class="font-semibold text-indigo-200">Bank-Level Security</p>
                        <p class="text-sm text-gray-400">We never store your login credentials</p>
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Username</label>
                    <input type="text" id="bank-username" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500" placeholder="Enter bank username">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Password</label>
                    <input type="password" id="bank-password" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500" placeholder="Enter bank password">
                </div>
                <button onclick="connectBank()" class="w-full py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl font-bold hover:shadow-lg transition-all flex items-center justify-center gap-2">
                    <i class="fas fa-link"></i> Connect Securely
                </button>
                <button onclick="backToBanks()" class="w-full py-3 border border-gray-600 rounded-xl hover:bg-gray-800 transition-all">Back</button>
            </div>

            <div id="bank-loading" class="hidden py-12 text-center">
                <div class="w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full sync-spinner mx-auto mb-4"></div>
                <p class="text-lg font-semibold">Connecting to your bank...</p>
                <div class="mt-6 space-y-2 text-left max-w-sm mx-auto px-4">
                    <div class="flex items-center gap-2 text-sm text-gray-400" id="step-1"><i class="fas fa-circle text-gray-600 text-xs"></i> Establishing secure connection</div>
                    <div class="flex items-center gap-2 text-sm text-gray-400" id="step-2"><i class="fas fa-circle text-gray-600 text-xs"></i> Authenticating credentials</div>
                    <div class="flex items-center gap-2 text-sm text-gray-400" id="step-3"><i class="fas fa-circle text-gray-600 text-xs"></i> Retrieving transactions</div>
                    <div class="flex items-center gap-2 text-sm text-gray-400" id="step-4"><i class="fas fa-circle text-gray-600 text-xs"></i> Categorizing with AI</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-40 glass border-b border-gray-800 hidden" id="main-nav">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
                        <i class="fas fa-piggy-bank text-xl"></i>
                    </div>
                    <span class="text-xl font-bold gradient-text">SmartSave AI</span>
                </div>
                <div class="flex items-center gap-6">
                    <div class="hidden md:flex items-center gap-2 px-4 py-2 rounded-full bg-orange-500/20 border border-orange-500/30">
                        <i class="fas fa-fire text-orange-500 streak-flame"></i>
                        <span class="font-bold text-orange-400" id="streak-display">0 Day Streak</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="openBankModal()" class="hidden sm:flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-500/20 border border-emerald-500/30 text-emerald-400 hover:bg-emerald-500/30 transition-all">
                            <i class="fas fa-plus"></i> Add Bank
                        </button>
                        
                        <!-- FIX: Profile menu with proper hover handling -->
                        <div class="profile-menu-container">
                            <button class="w-10 h-10 rounded-full bg-gradient-to-r from-pink-500 to-rose-500 flex items-center justify-center hover:scale-110 transition-transform">
                                <span id="user-initial" class="font-bold">U</span>
                            </button>
                            <div class="profile-dropdown glass rounded-xl border border-gray-700 p-2 bg-slate-900">
                                <button onclick="openBudgetModal()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 text-white flex items-center gap-2 mb-1">
                                    <i class="fas fa-wallet text-blue-400"></i> Set Budget
                                </button>
                                <button onclick="logout()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 text-red-400 flex items-center gap-2">
                                    <i class="fas fa-sign-out-alt"></i> Logout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Budget Modal -->
    <div id="budget-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeBudgetModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-6 glass rounded-2xl border border-gray-700 bg-slate-900">
            <h3 class="text-2xl font-bold mb-4">Set Monthly Budget</h3>
            <p class="text-gray-400 mb-4">Set a limit to track your spending</p>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Monthly Budget Amount ($)</label>
                    <input type="number" id="budget-input" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500" placeholder="2000" min="1">
                </div>
                <div class="flex gap-3 pt-2">
                    <button onclick="closeBudgetModal()" class="flex-1 py-3 rounded-xl border border-gray-600 hover:bg-gray-800 transition-all">Cancel</button>
                    <button onclick="setBudget()" class="flex-1 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl font-bold hover:shadow-lg transition-all">Set Budget</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="pt-24 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto hidden" id="main-content">
        
        <!-- Welcome -->
        <div class="mb-8 text-center slide-in">
            <h1 class="text-4xl md:text-5xl font-bold mb-2">Welcome, <span class="gradient-text" id="display-name">Saver</span>! üéâ</h1>
            <p class="text-gray-400 text-lg">Start your savings journey by connecting a bank or adding your first transaction</p>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Total Savings -->
            <div class="glass rounded-2xl p-6 card-hover relative overflow-hidden">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-400 text-sm mb-1">Total Savings</p>
                        <h3 class="text-3xl font-bold text-emerald-400" id="total-savings">$0</h3>
                    </div>
                    <div class="w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center">
                        <i class="fas fa-wallet text-emerald-400 text-xl"></i>
                    </div>
                </div>
                <p class="text-sm text-gray-500" id="savings-subtext">Start saving to see growth</p>
            </div>

            <!-- Monthly Budget -->
            <div class="glass rounded-2xl p-6 card-hover relative overflow-hidden cursor-pointer" onclick="openBudgetModal()">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-400 text-sm mb-1">Monthly Budget</p>
                        <h3 class="text-3xl font-bold text-blue-400" id="monthly-budget">Set Budget</h3>
                    </div>
                    <div class="w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center">
                        <i class="fas fa-calendar-alt text-blue-400 text-xl"></i>
                    </div>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                    <div class="bg-gray-600 h-2 rounded-full transition-all duration-500" style="width: 0%" id="budget-progress"></div>
                </div>
                <p class="text-xs text-gray-400 mt-2" id="budget-text">Click to set your monthly budget</p>
            </div>

            <!-- Active Goals -->
            <div class="glass rounded-2xl p-6 card-hover relative overflow-hidden">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-400 text-sm mb-1">Active Goals</p>
                        <h3 class="text-3xl font-bold text-purple-400" id="active-goals">0</h3>
                    </div>
                    <div class="w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center">
                        <i class="fas fa-bullseye text-purple-400 text-xl"></i>
                    </div>
                </div>
                <p class="text-sm text-gray-500">No active goals yet</p>
            </div>

            <!-- Streak -->
            <div class="glass rounded-2xl p-6 card-hover relative overflow-hidden">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-gray-400 text-sm mb-1">Current Streak</p>
                        <h3 class="text-3xl font-bold text-orange-400 flex items-center gap-2">
                            <span id="streak-count">0</span>
                            <i class="fas fa-fire text-2xl opacity-30"></i>
                        </h3>
                    </div>
                    <div class="w-12 h-12 rounded-xl bg-orange-500/20 flex items-center justify-center">
                        <i class="fas fa-trophy text-orange-400 text-xl"></i>
                    </div>
                </div>
                <p class="text-sm text-gray-400">Start logging to build streaks!</p>
            </div>
        </div>

        <!-- CTA -->
        <div class="mb-8 glass rounded-2xl p-8 border border-indigo-500/30 relative overflow-hidden bg-gradient-to-br from-indigo-900/20 to-purple-900/20 slide-in">
            <div class="relative z-10 flex flex-col md:flex-row items-center justify-between gap-6">
                <div class="flex items-center gap-4">
                    <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center flex-shrink-0 pulse-glow">
                        <i class="fas fa-rocket text-3xl"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold mb-1">Ready to start saving?</h3>
                        <p class="text-gray-400">Connect your bank account for automatic tracking</p>
                    </div>
                </div>
                <button onclick="openBankModal()" class="px-8 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl font-bold hover:shadow-lg hover:shadow-indigo-500/30 transition-all flex items-center gap-2 whitespace-nowrap">
                    <i class="fas fa-link"></i> Connect First Bank
                </button>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Column -->
            <div class="lg:col-span-2 space-y-8">
                
                <!-- Analytics -->
                <div class="glass rounded-2xl p-6 slide-in min-h-[400px] flex flex-col">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold flex items-center gap-2">
                            <i class="fas fa-chart-pie text-indigo-400"></i>
                            Spending Analytics
                        </h3>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 flex-1">
                        <div class="relative h-64" id="chart-wrapper">
                            <div id="chart-container" class="h-full flex items-center justify-center">
                                <div class="empty-state text-center">
                                    <i class="fas fa-chart-pie text-4xl text-gray-600 mb-3"></i>
                                    <h4 class="text-lg font-semibold text-gray-400 mb-2">No data yet</h4>
                                    <p class="text-sm text-gray-500 mb-4">Add a transaction to see analytics</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-4" id="category-breakdown">
                            <div class="empty-state text-center h-full flex flex-col items-center justify-center">
                                <i class="fas fa-list text-4xl text-gray-600 mb-3"></i>
                                <p class="text-sm text-gray-500">Categories will appear here</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Goals -->
                <div class="glass rounded-2xl p-6 slide-in">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold flex items-center gap-2">
                            <i class="fas fa-bullseye text-pink-400"></i>
                            Savings Goals
                        </h3>
                        <button onclick="openGoalModal()" class="px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg hover:shadow-lg hover:shadow-indigo-500/30 transition-all flex items-center gap-2">
                            <i class="fas fa-plus"></i> New Goal
                        </button>
                    </div>
                    <div id="goals-container" class="space-y-4">
                        <div class="empty-state py-8">
                            <i class="fas fa-bullseye text-gray-600"></i>
                            <h4 class="text-lg font-semibold text-gray-400 mb-2">No goals yet</h4>
                            <p class="text-sm text-gray-500">Create your first savings goal</p>
                        </div>
                    </div>
                </div>

                <!-- AI Advisor -->
                <div class="glass rounded-2xl p-6 slide-in border border-indigo-500/30 relative overflow-hidden">
                    <div class="flex items-start gap-4">
                        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center flex-shrink-0 floating">
                            <i class="fas fa-robot text-3xl"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-xl font-bold mb-2">AI Financial Advisor</h3>
                            <div class="p-4 rounded-lg bg-indigo-500/10 border border-indigo-500/20">
                                <p class="text-sm text-gray-300">Connect a bank or add transactions to get AI insights.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="space-y-8">
                
                <!-- Quick Add -->
                <div class="glass rounded-2xl p-6 slide-in">
                    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i class="fas fa-plus-circle text-emerald-400"></i>
                        Quick Add
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Amount</label>
                            <div class="relative">
                                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">$</span>
                                <input type="number" id="transaction-amount" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-8 py-3 focus:outline-none focus:border-emerald-500 transition-colors" placeholder="0.00" step="0.01">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Date</label>
                            <input type="date" id="transaction-date" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-emerald-500 transition-colors text-white">
                        </div>
                        
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Category</label>
                            <select id="transaction-category" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-emerald-500 transition-colors">
                                <option value="food">üçî Food & Dining</option>
                                <option value="shopping">üõçÔ∏è Shopping</option>
                                <option value="transport">üöó Transport</option>
                                <option value="entertainment">üé¨ Entertainment</option>
                                <option value="bills">üí° Bills</option>
                                <option value="income">üí∞ Income</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Type</label>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="setTransactionType('expense')" id="btn-expense" class="py-2 rounded-lg bg-rose-500/20 border border-rose-500 text-rose-400 font-semibold transition-all">Expense</button>
                                <button onclick="setTransactionType('income')" id="btn-income" class="py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-400 font-semibold transition-all">Income</button>
                            </div>
                        </div>
                        
                        <button onclick="addTransaction()" class="w-full py-3 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-xl font-bold hover:shadow-lg hover:shadow-emerald-500/30 transition-all flex items-center justify-center gap-2">
                            <i class="fas fa-check"></i> Add Transaction
                        </button>
                    </div>
                </div>

                <!-- Activity -->
                <div class="glass rounded-2xl p-6 slide-in">
                    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i class="fas fa-history text-blue-400"></i>
                        Recent Activity
                    </h3>
                    <div id="recent-activity" class="space-y-3">
                        <div class="empty-state py-8">
                            <i class="fas fa-receipt text-gray-600"></i>
                            <p class="text-sm text-gray-500">No transactions yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Goal Modal -->
    <div id="goal-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeGoalModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-6 glass rounded-2xl border border-gray-700 bg-slate-900">
            <h3 class="text-2xl font-bold mb-4">Create New Goal üéØ</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Goal Name</label>
                    <input type="text" id="goal-name" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500" placeholder="e.g., New Laptop">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Target Amount ($)</label>
                    <input type="number" id="goal-amount" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500" placeholder="1000">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Target Date</label>
                    <input type="date" id="goal-date" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Icon</label>
                    <div class="grid grid-cols-5 gap-2">
                        <button onclick="selectIcon('‚úàÔ∏è')" class="icon-btn p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-2xl border border-transparent">‚úàÔ∏è</button>
                        <button onclick="selectIcon('üöó')" class="icon-btn p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-2xl border border-transparent">üöó</button>
                        <button onclick="selectIcon('üè†')" class="icon-btn p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-2xl border border-transparent">üè†</button>
                        <button onclick="selectIcon('üéì')" class="icon-btn p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-2xl border border-transparent">üéì</button>
                        <button onclick="selectIcon('üíª')" class="icon-btn p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-2xl border border-transparent">üíª</button>
                    </div>
                </div>
                <div class="pt-4 flex gap-3">
                    <button onclick="closeGoalModal()" class="flex-1 py-3 rounded-xl border border-gray-600 hover:bg-gray-800 transition-all">Cancel</button>
                    <button onclick="createGoal()" class="flex-1 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl font-bold hover:shadow-lg transition-all">Create Goal</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="fixed bottom-4 right-4 z-50 hidden">
        <div class="glass rounded-xl p-4 border border-emerald-500/30 flex items-center gap-3 notification bg-slate-900">
            <div class="w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center">
                <i class="fas fa-check text-emerald-400"></i>
            </div>
            <div>
                <p class="font-bold text-emerald-400" id="notif-title">Success!</p>
                <p class="text-sm text-gray-300" id="notif-message">Transaction added successfully</p>
            </div>
        </div>
    </div>

    <script>
        // State
        let currentTransactionType = 'expense';
        let selectedIcon = '‚úàÔ∏è';
        let streakCount = 0;
        let savings = 0;
        let currentUser = null;
        let connectedBanks = [];
        let transactions = [];
        let goals = [];
        let spendingChart = null;
        let monthlyBudget = 0;
        let budgetSpent = 0;

        // Category patterns
        const categoryPatterns = {
            food: ['restaurant', 'cafe', 'coffee', 'pizza', 'burger', 'grocery', 'supermarket', 'food', 'dining'],
            transport: ['uber', 'lyft', 'taxi', 'gas', 'fuel', 'parking', 'transit', 'bus', 'train', 'metro'],
            shopping: ['amazon', 'walmart', 'target', 'costco', 'best buy', 'apple store', 'clothing', 'shoes'],
            entertainment: ['netflix', 'spotify', 'cinema', 'movie', 'game', 'steam', 'hulu', 'disney'],
            bills: ['electric', 'water', 'internet', 'phone', 'rent', 'mortgage', 'insurance', 'subscription']
        };

        function initDatePicker() {
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('transaction-date');
            if (dateInput) {
                dateInput.value = today;
                dateInput.max = today;
            }
        }

        // Budget Functions
        function openBudgetModal() {
            document.getElementById('budget-modal').classList.remove('hidden');
            document.getElementById('budget-input').value = monthlyBudget > 0 ? monthlyBudget : '';
            document.getElementById('budget-input').focus();
        }

        function closeBudgetModal() {
            document.getElementById('budget-modal').classList.add('hidden');
        }

        function setBudget() {
            const amount = parseFloat(document.getElementById('budget-input').value);
            if (!amount || amount <= 0) {
                showNotification('Error', 'Please enter a valid budget amount', 'error');
                return;
            }
            
            monthlyBudget = amount;
            updateBudgetDisplay();
            closeBudgetModal();
            showNotification('Budget Set', `Monthly budget set to $${monthlyBudget.toLocaleString()}`, 'success');
        }

        function updateBudgetDisplay() {
            const budgetEl = document.getElementById('monthly-budget');
            const progressEl = document.getElementById('budget-progress');
            const textEl = document.getElementById('budget-text');
            
            if (monthlyBudget > 0) {
                budgetEl.textContent = `$${monthlyBudget.toLocaleString()}`;
                const percent = Math.min((budgetSpent / monthlyBudget) * 100, 100);
                progressEl.style.width = percent + '%';
                
                // Color based on usage
                progressEl.className = 'h-2 rounded-full transition-all duration-500 ' + 
                    (percent > 90 ? 'bg-red-500' : percent > 75 ? 'bg-yellow-500' : 'bg-blue-500');
                
                const remaining = monthlyBudget - budgetSpent;
                textEl.textContent = `$${budgetSpent.toLocaleString()} spent ‚Ä¢ $${remaining.toLocaleString()} left`;
            }
        }

        // Auth
        function switchAuthMode(mode) {
            const loginTab = document.getElementById('tab-login');
            const registerTab = document.getElementById('tab-register');
            const nameField = document.getElementById('name-field');
            const btnText = document.getElementById('auth-btn-text');
            
            if (mode === 'login') {
                loginTab.className = 'flex-1 py-2 rounded-xl bg-indigo-600 text-white font-semibold transition-all';
                registerTab.className = 'flex-1 py-2 rounded-xl bg-gray-800 text-gray-400 font-semibold transition-all';
                nameField.classList.add('hidden');
                btnText.textContent = 'Login';
            } else {
                loginTab.className = 'flex-1 py-2 rounded-xl bg-gray-800 text-gray-400 font-semibold transition-all';
                registerTab.className = 'flex-1 py-2 rounded-xl bg-indigo-600 text-white font-semibold transition-all';
                nameField.classList.remove('hidden');
                btnText.textContent = 'Create Account';
            }
        }

        document.getElementById('auth-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('user-email').value;
            const name = document.getElementById('user-name').value || 'Saver';
            
            currentUser = { email, name, id: Date.now() };
            localStorage.setItem('smartsave_user', JSON.stringify(currentUser));
            
            document.getElementById('demo-background').style.display = 'none';
            document.getElementById('auth-modal').classList.add('fade-out');
            
            setTimeout(() => {
                document.getElementById('auth-modal').style.display = 'none';
                document.getElementById('main-content').classList.remove('hidden');
                document.getElementById('main-nav').classList.remove('hidden');
                document.getElementById('display-name').textContent = name;
                document.getElementById('user-initial').textContent = name[0].toUpperCase();
                
                initDatePicker();
                showNotification('Welcome!', `Your fresh start begins now, ${name}!`, 'success');
            }, 500);
        });

        function logout() {
            localStorage.removeItem('smartsave_user');
            location.reload();
        }

        // Chart Functions
        function updateChartWithData() {
            const breakdown = {};
            transactions.forEach(t => {
                if (t.type === 'expense') {
                    breakdown[t.category] = (breakdown[t.category] || 0) + t.amount;
                }
            });
            
            if (Object.keys(breakdown).length === 0) return;
            
            const chartContainer = document.getElementById('chart-container');
            chartContainer.innerHTML = '<canvas id="spendingChart"></canvas>';
            
            const labels = Object.keys(breakdown).map(c => c.charAt(0).toUpperCase() + c.slice(1));
            const data = Object.values(breakdown);
            const colors = [
                'rgba(244, 63, 94, 0.8)',
                'rgba(59, 130, 246, 0.8)',
                'rgba(16, 185, 129, 0.8)',
                'rgba(139, 92, 246, 0.8)',
                'rgba(245, 158, 11, 0.8)'
            ];
            
            if (spendingChart) {
                spendingChart.destroy();
            }
            
            const ctx = document.getElementById('spendingChart').getContext('2d');
            spendingChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#9ca3af', padding: 15, usePointStyle: true, font: { size: 11 } }
                        }
                    },
                    cutout: '60%'
                }
            });
            
            updateCategoryBreakdown(breakdown);
        }

        function updateCategoryBreakdown(breakdownData) {
            const container = document.getElementById('category-breakdown');
            if (!container) return;
            
            const total = Object.values(breakdownData).reduce((a, b) => a + b, 0);
            
            const colors = {
                food: { color: 'rose', icon: 'fa-utensils', label: 'Food & Dining' },
                shopping: { color: 'blue', icon: 'fa-shopping-bag', label: 'Shopping' },
                transport: { color: 'emerald', icon: 'fa-bus', label: 'Transport' },
                entertainment: { color: 'purple', icon: 'fa-film', label: 'Entertainment' },
                bills: { color: 'yellow', icon: 'fa-bolt', label: 'Bills' },
                others: { color: 'gray', icon: 'fa-receipt', label: 'Others' }
            };
            
            container.innerHTML = Object.entries(breakdownData)
                .sort((a, b) => b[1] - a[1])
                .map(([cat, amount]) => {
                    const config = colors[cat] || colors.others;
                    const percent = total > 0 ? ((amount / total) * 100).toFixed(0) : 0;
                    return `
                        <div class="flex items-center justify-between p-3 rounded-xl bg-gray-800/50 slide-in">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-${config.color}-500/20 flex items-center justify-center">
                                    <i class="fas ${config.icon} text-${config.color}-400"></i>
                                </div>
                                <div>
                                    <p class="font-semibold text-sm">${config.label}</p>
                                    <p class="text-xs text-gray-400">${percent}% of spending</p>
                                </div>
                            </div>
                            <span class="font-bold text-${config.color}-400">$${amount.toFixed(0)}</span>
                        </div>
                    `;
                }).join('');
        }

        // Bank Functions
        function openBankModal() {
            document.getElementById('bank-modal').classList.remove('hidden');
            document.getElementById('bank-selection').classList.remove('hidden');
            document.getElementById('bank-login').classList.add('hidden');
            document.getElementById('bank-loading').classList.add('hidden');
        }

        function closeBankModal() {
            document.getElementById('bank-modal').classList.add('hidden');
        }

        function selectBank(bankName) {
            document.getElementById('bank-selection').classList.add('hidden');
            document.getElementById('bank-login').classList.remove('hidden');
            document.getElementById('bank-login').dataset.bank = bankName;
        }

        function backToBanks() {
            document.getElementById('bank-selection').classList.remove('hidden');
            document.getElementById('bank-login').classList.add('hidden');
        }

        function connectBank() {
            const bankName = document.getElementById('bank-login').dataset.bank;
            document.getElementById('bank-login').classList.add('hidden');
            document.getElementById('bank-loading').classList.remove('hidden');
            
            setTimeout(() => updateStep(1), 800);
            setTimeout(() => updateStep(2), 1600);
            setTimeout(() => updateStep(3), 2400);
            setTimeout(() => {
                updateStep(4);
                completeBankConnection(bankName);
            }, 3200);
        }

        function updateStep(step) {
            const steps = ['step-1', 'step-2', 'step-3', 'step-4'];
            document.getElementById(steps[step-1]).innerHTML = `<i class="fas fa-check-circle text-emerald-400"></i> ${document.getElementById(steps[step-1]).innerText.replace('‚Ä¢ ', '')}`;
        }

        function completeBankConnection(bankName) {
            const bankId = Date.now();
            const balance = Math.floor(Math.random() * 5000) + 1000;
            connectedBanks.push({ id: bankId, name: bankName, balance: balance });
            
            // Income increases savings
            savings += balance;
            updateSavingsDisplay();
            
            generateMockTransactions(bankName);
            
            setTimeout(() => {
                closeBankModal();
                showNotification('Bank Connected!', `${bankName} linked with $${balance.toLocaleString()}`, 'success');
                createConfetti();
            }, 1000);
        }

        function updateSavingsDisplay() {
            document.getElementById('total-savings').textContent = `$${savings.toLocaleString()}`;
            const subtext = document.getElementById('savings-subtext');
            if (savings > 0) {
                subtext.textContent = 'Keep building your wealth!';
                subtext.className = 'text-sm text-emerald-500';
            }
        }

        function generateMockTransactions(bankName) {
            const merchants = {
                food: ['Starbucks', 'Chipotle', 'Whole Foods'],
                transport: ['Shell', 'Uber'],
                shopping: ['Amazon', 'Target']
            };
            
            const newTransactions = [];
            Object.entries(merchants).forEach(([category, merchantList]) => {
                merchantList.forEach(merchant => {
                    const amount = (Math.random() * 50 + 10).toFixed(2);
                    const date = new Date();
                    date.setDate(date.getDate() - Math.floor(Math.random() * 3));
                    
                    newTransactions.push({
                        id: Date.now() + Math.random(),
                        merchant,
                        amount: parseFloat(amount),
                        category,
                        date: date.toISOString(),
                        bank: bankName,
                        type: 'expense'
                    });
                    
                    // Expenses affect budget, NOT savings
                    budgetSpent += parseFloat(amount);
                });
            });
            
            transactions = [...newTransactions, ...transactions];
            updateBudgetDisplay();
            updateTransactionsUI();
            updateChartWithData();
            updateStreak();
        }

        function updateStreak() {
            streakCount = 1;
            document.getElementById('streak-count').textContent = streakCount;
            document.getElementById('streak-display').textContent = `${streakCount} Day Streak`;
            const fireIcon = document.querySelector('.fa-fire');
            if (fireIcon) {
                fireIcon.classList.remove('opacity-30');
                fireIcon.classList.add('streak-flame', 'text-orange-500');
            }
        }

        function updateTransactionsUI() {
            const container = document.getElementById('recent-activity');
            if (transactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state py-8">
                        <i class="fas fa-receipt text-gray-600"></i>
                        <p class="text-sm text-gray-500">No transactions yet</p>
                    </div>
                `;
                return;
            }
            
            const categoryIcons = {
                food: 'fa-coffee',
                shopping: 'fa-shopping-bag',
                transport: 'fa-bus',
                entertainment: 'fa-film',
                bills: 'fa-bolt',
                others: 'fa-receipt'
            };
            
            const categoryColors = {
                food: 'rose',
                shopping: 'blue',
                transport: 'emerald',
                entertainment: 'purple',
                bills: 'yellow',
                others: 'gray'
            };
            
            container.innerHTML = transactions.slice(0, 5).map(t => {
                const color = categoryColors[t.category];
                const icon = categoryIcons[t.category];
                const date = new Date(t.date);
                const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                return `
                    <div class="flex items-center justify-between p-3 rounded-lg bg-gray-800/50 hover:bg-gray-800 transition-colors slide-in">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-${color}-500/20 flex items-center justify-center">
                                <i class="fas ${icon} text-${color}-400"></i>
                            </div>
                            <div>
                                <p class="font-semibold text-sm">${t.merchant}</p>
                                <p class="text-xs text-gray-500">${dateStr} ‚Ä¢ <span class="text-${color}-400 capitalize">${t.category}</span></p>
                            </div>
                        </div>
                        <span class="text-rose-400 font-bold">-$${t.amount.toFixed(2)}</span>
                    </div>
                `;
            }).join('');
        }

        // Transaction Functions
        function setTransactionType(type) {
            currentTransactionType = type;
            const expenseBtn = document.getElementById('btn-expense');
            const incomeBtn = document.getElementById('btn-income');
            
            if (type === 'expense') {
                expenseBtn.className = 'py-2 rounded-lg bg-rose-500/20 border border-rose-500 text-rose-400 font-semibold transition-all';
                incomeBtn.className = 'py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-400 font-semibold transition-all';
            } else {
                expenseBtn.className = 'py-2 rounded-lg bg-gray-800 border border-gray-700 text-gray-400 font-semibold transition-all';
                incomeBtn.className = 'py-2 rounded-lg bg-emerald-500/20 border border-emerald-500 text-emerald-400 font-semibold transition-all';
            }
        }

        function addTransaction() {
            const amount = parseFloat(document.getElementById('transaction-amount').value);
            const category = document.getElementById('transaction-category').value;
            const dateInput = document.getElementById('transaction-date').value;
            
            if (!amount || amount <= 0) {
                showNotification('Error', 'Please enter a valid amount', 'error');
                return;
            }

            const isIncome = currentTransactionType === 'income';
            const merchant = isIncome ? 'Manual Income' : `${category.charAt(0).toUpperCase() + category.slice(1)} Expense`;
            
            const transactionDate = dateInput ? new Date(dateInput) : new Date();
            
            transactions.unshift({
                id: Date.now(),
                merchant,
                amount,
                category,
                date: transactionDate.toISOString(),
                type: currentTransactionType
            });
            
            if (isIncome) {
                // INCOME: Increases savings
                savings += amount;
                updateSavingsDisplay();
            } else {
                // EXPENSE: Decreases savings AND affects budget
                savings -= amount;
                updateSavingsDisplay();
                
                budgetSpent += amount;
                updateBudgetDisplay();
            }
            
            updateTransactionsUI();
            updateChartWithData();
            
            if (transactions.length === 1) {
                updateStreak();
                createConfetti();
                showNotification('First Step!', 'You\'ve started your savings journey!', 'success');
            } else {
                showNotification('Success', 'Transaction added!', 'success');
            }
            
            document.getElementById('transaction-amount').value = '';
            initDatePicker();
        }

        // Goal Functions
        function openGoalModal() {
            document.getElementById('goal-modal').classList.remove('hidden');
        }

        function closeGoalModal() {
            document.getElementById('goal-modal').classList.add('hidden');
        }

        function selectIcon(icon) {
            selectedIcon = icon;
            document.querySelectorAll('.icon-btn').forEach(btn => {
                btn.classList.remove('bg-indigo-600', 'border-indigo-500');
                btn.classList.add('bg-gray-800', 'border-transparent');
            });
            event.target.classList.remove('bg-gray-800', 'border-transparent');
            event.target.classList.add('bg-indigo-600', 'border-indigo-500');
        }

        function createGoal() {
            const name = document.getElementById('goal-name').value;
            const amount = parseFloat(document.getElementById('goal-amount').value);
            const date = document.getElementById('goal-date').value;
            
            if (!name || !amount || !date) {
                showNotification('Error', 'Please fill all fields', 'error');
                return;
            }

            const months = Math.ceil((new Date(date) - new Date()) / (1000 * 60 * 60 * 24 * 30));
            const color = ['yellow', 'blue', 'purple', 'pink', 'indigo'][goals.length % 5];
            
            const goal = { name, target: amount, saved: 0, icon: selectedIcon, months, color };
            goals.push(goal);
            renderGoals();
            
            closeGoalModal();
            createConfetti();
            showNotification('Goal Created!', 'Your savings journey begins!', 'success');
            
            document.getElementById('goal-name').value = '';
            document.getElementById('goal-amount').value = '';
            document.getElementById('goal-date').value = '';
        }

        function renderGoals() {
            const container = document.getElementById('goals-container');
            document.getElementById('active-goals').textContent = goals.length;
            
            if (goals.length === 0) {
                container.innerHTML = `
                    <div class="empty-state py-8">
                        <i class="fas fa-bullseye text-gray-600"></i>
                        <h4 class="text-lg font-semibold text-gray-400 mb-2">No goals yet</h4>
                        <p class="text-sm text-gray-500">Create your first savings goal</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = goals.map((goal) => {
                const monthlyNeed = (goal.target / goal.months).toFixed(0);
                
                return `
                    <div class="p-4 rounded-xl bg-gradient-to-r from-gray-800 to-gray-900 border border-gray-700 relative overflow-hidden group slide-in">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-${goal.color}-400 to-${goal.color}-600 flex items-center justify-center text-2xl">
                                    ${goal.icon}
                                </div>
                                <div>
                                    <h4 class="font-bold text-lg">${goal.name}</h4>
                                    <p class="text-sm text-gray-400">Target: ${goal.months} months ‚Ä¢ $${goal.target.toLocaleString()}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-2xl font-bold text-${goal.color}-400">$0</p>
                                <p class="text-xs text-gray-400">saved</p>
                            </div>
                        </div>
                        <div class="relative pt-1">
                            <div class="flex mb-2 items-center justify-between">
                                <div class="text-xs font-semibold text-${goal.color}-400">0% Complete</div>
                                <div class="text-xs text-gray-400">$${goal.target.toLocaleString()} to go</div>
                            </div>
                            <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-700">
                                <div style="width:0%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-gradient-to-r from-${goal.color}-400 to-${goal.color}-600 transition-all duration-500"></div>
                            </div>
                            <div class="flex items-center justify-between text-xs">
                                <span class="text-gray-400">Monthly need: <span class="text-white font-bold">$${monthlyNeed}</span></span>
                                <span class="text-gray-400 flex items-center gap-1">
                                    <i class="fas fa-clock"></i> Just started
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function createConfetti() {
            const colors = ['#f43f5e', '#8b5cf6', '#10b981', '#f59e0b', '#3b82f6'];
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    document.getElementById('confetti-container').appendChild(confetti);
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 30);
            }
        }

        function showNotification(title, message, type = 'success') {
            const notif = document.getElementById('notification');
            const notifTitle = document.getElementById('notif-title');
            const notifMessage = document.getElementById('notif-message');
            
            const colors = {
                success: 'emerald',
                error: 'rose',
                info: 'blue'
            };
            
            const color = colors[type];
            notif.querySelector('.glass').className = `glass rounded-xl p-4 border border-${color}-500/30 flex items-center gap-3 notification bg-slate-900`;
            notif.querySelector('i').className = `fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation' : 'info'} text-${color}-400`;
            notifTitle.className = `font-bold text-${color}-400`;
            
            notifTitle.textContent = title;
            notifMessage.textContent = message;
            
            notif.classList.remove('hidden');
            setTimeout(() => notif.classList.add('hidden'), 3000);
        }

        // Check auth on load
        window.addEventListener('load', () => {
            const saved = localStorage.getItem('smartsave_user');
            if (saved) {
                currentUser = JSON.parse(saved);
                document.getElementById('demo-background').style.display = 'none';
                document.getElementById('auth-modal').style.display = 'none';
                document.getElementById('main-content').classList.remove('hidden');
                document.getElementById('main-nav').classList.remove('hidden');
                document.getElementById('display-name').textContent = currentUser.name;
                document.getElementById('user-initial').textContent = currentUser.name[0].toUpperCase();
                initDatePicker();
                renderGoals();
            }
        });
    </script>
</body>
</html>